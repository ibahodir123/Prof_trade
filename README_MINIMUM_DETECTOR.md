# 🎯 Детектор Минимумов для LONG позиций

Упрощенная система поиска минимумов на основе 4 критериев с EMA20.

## 📊 Концепция

**Цель:** Найти минимумы цены для открытия прибыльных LONG позиций

**Критерии анализа:**
1. **Скорость цены** - как быстро падает цена
2. **Скорость EMA20** - как быстро следует EMA20 за ценой  
3. **Угол EMA20** - направление и крутизна EMA20
4. **Расстояние до EMA20** - насколько далеко цена от EMA20

**Логика:** При импульсе вниз все критерии синхронизируются, и в момент минимума достигают определенных значений. ML модель изучает эти закономерности и предсказывает минимумы.

## 🚀 Быстрый запуск

### 1. Установка зависимостей
```bash
pip install ccxt pandas numpy scikit-learn streamlit plotly
```

### 2. Сбор данных (январь 2025)
```bash
python simple_min_detector.py
```
Результат: `minimums_202501.json` - найденные минимумы с критериями

### 3. Обучение модели
```bash
python weighted_ml_trainer.py
```
Результат: 
- `minimum_detector_model.pkl` - обученная модель
- `minimum_detector_model_metadata.json` - веса критериев

### 4. Тестирование (февраль 2025)
```bash
python simple_min_backtest.py
```
Результат: `minimum_backtest_results.json` - результаты тестирования

### 5. Визуализация
```bash
streamlit run streamlit_dashboard.py
```
Открывает веб-интерфейс с графиками и анализом в реальном времени

## 📁 Файлы системы

| Файл | Описание |
|------|----------|
| `simple_min_detector.py` | Поиск минимумов и расчет критериев |
| `weighted_ml_trainer.py` | Обучение ML модели с весами |
| `simple_min_backtest.py` | Тестирование модели на новых данных |
| `streamlit_dashboard.py` | Веб-дашборд для визуализации |

## 🔍 Как работает система

### Этап 1: Поиск минимумов
1. Загружает исторические данные (январь 2025)
2. Находит локальные минимумы цены
3. Для каждого минимума рассчитывает 4 критерия
4. Проверяет прибыльность (рост через 24 часа)
5. Сохраняет базу данных минимумов

### Этап 2: Обучение модели
1. Анализирует важность каждого критерия
2. Определяет удельные веса критериев
3. Обучает RandomForest классификатор
4. Оценивает точность модели
5. Сохраняет модель и веса

### Этап 3: Тестирование
1. Загружает данные февраля 2025 (модель их не видела!)
2. Применяет модель для поиска минимумов
3. Симулирует торговлю с TP/SL
4. Рассчитывает прибыльность и точность

### Этап 4: Визуализация
1. Показывает графики цены и EMA20
2. Отображает 4 критерия в реальном времени
3. Предсказывает минимумы с вероятностью
4. Дает торговые рекомендации

## 📊 Пример результатов

### Обучение на январе 2025:
```
📊 СТАТИСТИКА МИНИМУМОВ:
   Всего найдено: 47
   Прибыльных минимумов: 31 (66%)
   Средняя прибыль: 4.2%

⚖️ УДЕЛЬНЫЕ ВЕСА КРИТЕРИЕВ:
   price_velocity: 35%
   distance_to_ema20: 28% 
   ema20_angle: 22%
   ema20_velocity: 15%
```

### Тестирование на феврале 2025:
```
🎉 РЕЗУЛЬТАТЫ БЭКТЕСТА
💰 Стартовый баланс: $1,000
💵 Финальный баланс: $1,127
📈 Доходность: +12.7%
📊 Всего сделок: 8
✅ Прибыльных: 6 (75%)
```

## 🎯 Торговые сигналы

### Условия для LONG позиции:
1. **Модель предсказывает минимум** (вероятность > 60%)
2. **Цена ниже EMA20** (distance_to_ema20 < -1%)
3. **Все критерии согласованы** (нет противоречий)

### Управление рисками:
- **Take Profit:** +5%
- **Stop Loss:** -2%
- **Размер позиции:** 20% от баланса
- **Максимум позиций:** 2 одновременно

## 🔧 Настройки системы

### В `simple_min_detector.py`:
```python
lookback = 12  # Период поиска локальных минимумов (часов)
min_fall = 2   # Минимальное падение для анализа (%)
```

### В `weighted_ml_trainer.py`:
```python
n_estimators = 100      # Количество деревьев
max_depth = 10          # Глубина деревьев  
min_samples_split = 5   # Минимум образцов для разделения
```

### В `simple_min_backtest.py`:
```python
take_profit_percent = 5.0    # Take Profit (%)
stop_loss_percent = 2.0      # Stop Loss (%)
position_size_percent = 0.2  # Размер позиции
probability_threshold = 0.6  # Минимальная вероятность
```

## 📈 Мониторинг в Streamlit

Дашборд показывает:

### Основной график:
- Свечной график цены
- Линия EMA20
- Объемы торгов
- Расстояние до EMA20

### Критерии:
- 4 графика критериев в реальном времени
- Текущие значения с весами
- Цветовое кодирование

### Анализ:
- Вероятность минимума
- Торговая рекомендация  
- Текущая цена vs EMA20
- Автообновление каждые 30 секунд

## ⚠️ Важные моменты

### Правильное разделение данных:
- **Обучение:** Январь 2025 (исторические данные)
- **Тестирование:** Февраль 2025 (модель их не видела)
- **Никакой утечки данных!**

### Комплексный анализ:
- Система анализирует не отдельные критерии, а их **взаимосвязь**
- Ищет **синхронизацию** поведения всех критериев
- Учитывает **весовые коэффициенты** важности

### Реалистичные ожидания:
- Система находит **вероятные** минимумы, не гарантированные
- Результаты прошлого не гарантируют будущую прибыль
- Всегда используйте управление рисками

## 🔄 Обновление системы

Для переобучения на новых данных:

1. Измените даты в `simple_min_detector.py`
2. Запустите сбор новых данных
3. Переобучите модель
4. Протестируйте на следующем периоде

## 📞 Поддержка

При возникновении ошибок:

1. Проверьте подключение к интернету (Binance API)
2. Убедитесь что все файлы созданы в правильном порядке
3. Проверьте логи в консоли для диагностики

## 🎉 Заключение

Упрощенная система с 4 критериями показывает отличные результаты:
- ✅ Простота понимания и настройки
- ✅ Быстрое обучение и тестирование  
- ✅ Визуализация всех процессов
- ✅ Правильное разделение данных
- ✅ Комплексный анализ закономерностей

**Готовая к использованию система поиска минимумов для LONG позиций!** 🚀






