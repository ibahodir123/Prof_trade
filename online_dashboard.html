<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ –î–µ—Ç–µ–∫—Ç–æ—Ä –ú–∏–Ω–∏–º—É–º–æ–≤ - –û–Ω–ª–∞–π–Ω –î–∞—à–±–æ—Ä–¥</title>
    <script src="https://s3.tradingview.com/tv.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- –ü—Ä–æ—Å—Ç–∞—è ML –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ -->
    <script src="https://cdn.jsdelivr.net/npm/ml-matrix@6.10.4/lib/ml-matrix.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 95%;
            margin: 0 auto;
            padding: 10px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .panel {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .chart-container {
            grid-column: 1 / -1;
            height: 80vh;
            min-height: 600px;
            background: rgba(255,255,255,0.98);
            border-radius: 15px;
            padding: 8px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        
        .indicators {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .indicator {
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .indicator-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .indicator-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.2em;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .status.bullish { color: #4CAF50; }
        .status.bearish { color: #f44336; }
        .status.neutral { color: #FF9800; }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .prediction-box {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-size: 1.1em;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
            @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 70vh;
                min-height: 400px;
            }
            
            .indicators {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .container {
                padding: 5px;
            }
            
            body {
                padding: 5px;
            }
        }
        
        /* üéØ –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è BUY —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ –î–µ—Ç–µ–∫—Ç–æ—Ä –ú–∏–Ω–∏–º—É–º–æ–≤</h1>
            <p>–û–Ω–ª–∞–π–Ω –∞–Ω–∞–ª–∏–∑ –º–∏–Ω–∏–º—É–º–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ EMA20</p>
        </div>

        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ñ–∞–∑—ã -->
        <div style="text-align: center; margin-bottom: 15px;">
            <div id="phase-indicator" style="display: inline-block; padding: 8px 20px; background: linear-gradient(45deg, #FF9800, #FFC107); color: white; border-radius: 20px; font-weight: bold; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);">
                üéì –§–ê–ó–ê –û–ë–£–ß–ï–ù–ò–Ø: –Ø–Ω–≤–∞—Ä—å 2025
            </div>
            <button id="mode-switch-btn" style="
                margin-left: 15px;
                padding: 8px 16px;
                background: linear-gradient(45deg, #4CAF50, #45a049);
                color: white;
                border: none;
                border-radius: 15px;
                cursor: pointer;
                font-size: 12px;
                font-weight: bold;
                box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
                transition: all 0.3s ease;
            " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                üîÑ –ö–û–†–†–ï–ö–¶–ò–Ø (EXIT LONG)
            </button>
        </div>

        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã -->
        <div class="indicators">
            <div class="indicator">
                <div class="indicator-value" id="price-velocity">-0.012</div>
                <div class="indicator-label">üìà –°–∫–æ—Ä–æ—Å—Ç—å —Ü–µ–Ω—ã</div>
            </div>
            <div class="indicator">
                <div class="indicator-value" id="ema20-velocity">-0.008</div>
                <div class="indicator-label">‚ö° –°–∫–æ—Ä–æ—Å—Ç—å EMA20</div>
            </div>
            <div class="indicator">
                <div class="indicator-value" id="ema20-angle">-0.2¬∞</div>
                <div class="indicator-label">üìê –£–≥–æ–ª EMA20</div>
            </div>
            <div class="indicator">
                <div class="indicator-value" id="price-distance">-1.8%</div>
                <div class="indicator-label">üìè –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ EMA20</div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è -->
        <div class="prediction-box">
            <div id="prediction-status" class="status neutral">
                ü§ñ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ä—ã–Ω–æ–∫... –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            </div>
            <div id="prediction-confidence">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 0%</div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫ TradingView -->
        <div class="chart-container">
            <div id="tradingview_chart" style="height: 100%; width: 100%; min-height: 600px;"></div>
        </div>

        <!-- –ü–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="dashboard">
            <div class="panel">
                <h3>üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <div class="controls">
                    <select id="symbol-select" class="btn">
                        <option value="BTCUSDT">BTC/USDT</option>
                        <option value="ETHUSDT">ETH/USDT</option>
                        <option value="ADAUSDT">ADA/USDT</option>
                    </select>
                    <select id="timeframe-select" class="btn">
                        <option value="1h">1 —á–∞—Å</option>
                        <option value="4h">4 —á–∞—Å–∞</option>
                        <option value="1D">1 –¥–µ–Ω—å</option>
                    </select>
                </div>
                <button class="btn" onclick="updateAnalysis()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                
                <!-- üí∞ –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–ò–ë–´–õ–¨–ù–û–°–¢–ò -->
                <h4 style="margin-top: 20px; color: #FFD700;">üí∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                    <div style="text-align: center; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                        <div style="font-size: 1.2em; font-weight: bold;" id="win-rate">0.0%</div>
                        <div style="font-size: 0.8em; opacity: 0.8;">–í–∏–Ω—Ä–µ–π—Ç</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                        <div style="font-size: 1.2em; font-weight: bold;" id="total-profit">$0</div>
                        <div style="font-size: 0.8em; opacity: 0.8;">–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                        <div style="font-size: 1.2em; font-weight: bold;" id="avg-profit">0$</div>
                        <div style="font-size: 0.8em; opacity: 0.8;">–°—Ä–µ–¥–Ω—è—è —Å–¥–µ–ª–∫–∞</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                        <div style="font-size: 1.2em; font-weight: bold;" id="active-trades">0</div>
                        <div style="font-size: 0.8em; opacity: 0.8;">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>üéØ –ò—Å—Ç–æ—Ä–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ & BUY –º–∞—Ä–∫–µ—Ä—ã</h3>
                <div id="signals-history">
                    <div style="padding: 8px; margin: 5px 0; background: rgba(158, 158, 158, 0.2); border-radius: 5px; text-align: center; font-style: italic;">
                        –û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ ML —Å–∏—Å—Ç–µ–º—ã...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ====================================
        // ü§ñ –ë–†–ê–£–ó–ï–†–ù–ê–Ø ML –°–ò–°–¢–ï–ú–ê
        // ====================================
        
        class MinimumDetectorML {
            constructor() {
                this.trainingData = [];
                this.currentPhase = 'training'; // 'training' –∏–ª–∏ 'backtesting'
                this.currentMonth = 'january'; // 'january' –∏–ª–∏ 'february'
                
                // üéØ –†–ï–ñ–ò–ú –î–ï–¢–ï–ö–¶–ò–ò: –º–∏–Ω–∏–º—É–º—ã –∏–ª–∏ –º–∞–∫—Å–∏–º—É–º—ã
                this.detectionMode = 'minimums'; // 'minimums' –∏–ª–∏ 'maximums'
                
                // üìâ –í–ï–°–ê –î–õ–Ø –ú–ò–ù–ò–ú–£–ú–û–í (–∏–º–ø—É–ª—å—Å—ã –≤–Ω–∏–∑ ‚Üí LONG —Å–∏–≥–Ω–∞–ª—ã)
                this.weightsMinimums = {
                    priceVelocity: 0.35,    // 35% - –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –≤–∞–∂–Ω–∞
                    ema20Velocity: 0.30,    // 30% - –ø–∞–¥–µ–Ω–∏–µ EMA20
                    ema20Angle: 0.25,       // 25% - —É–≥–æ–ª –≤–Ω–∏–∑
                    priceDistance: 0.10     // 10% - —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –Ω–∏–∂–µ EMA20
                };
                
                // üìà –í–ï–°–ê –î–õ–Ø –ú–ê–ö–°–ò–ú–£–ú–û–í (–∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –≤–≤–µ—Ä—Ö ‚Üí EXIT LONG —Å–∏–≥–Ω–∞–ª—ã)  
                this.weightsMaximums = {
                    priceVelocity: 0.25,    // 25% - –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
                    ema20Velocity: 0.25,    // 25% - —Ä–æ—Å—Ç EMA20
                    ema20Angle: 0.35,       // 35% - —É–≥–æ–ª –≤–≤–µ—Ä—Ö –í–ê–ñ–ù–ï–ï!
                    priceDistance: 0.15     // 15% - —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤—ã—à–µ EMA20
                };
                
                // üéØ –ê–ö–¢–ò–í–ù–´–ï –í–ï–°–ê (–Ω–∞—á–∏–Ω–∞–µ–º —Å –º–∏–Ω–∏–º—É–º–æ–≤)
                this.weights = {...this.weightsMinimums};
                
                // üí∞ –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–ó–ò–¶–ò–ï–ô
                this.positionState = {
                    isOpen: false,           // –û—Ç–∫—Ä—ã—Ç–∞ –ª–∏ LONG –ø–æ–∑–∏—Ü–∏—è
                    entryPrice: 0,           // –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞
                    entryTime: null,         // –í—Ä–µ–º—è –≤—Ö–æ–¥–∞
                    currentPhase: 'impulse', // 'impulse' –∏–ª–∏ 'correction'
                    profits: []              // –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∏–±—ã–ª–µ–π
                };
                
                // üìä –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –≤–µ—Å–∞ (–º–µ–Ω—è—é—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π)
                this.adaptiveWeights = {
                    volatileMarket: {       // –í–æ–ª–∞—Ç–∏–ª—å–Ω—ã–π —Ä—ã–Ω–æ–∫
                        priceVelocity: 0.40,
                        ema20Velocity: 0.35,
                        ema20Angle: 0.20,
                        priceDistance: 0.05
                    },
                    trendingMarket: {       // –¢—Ä–µ–Ω–¥–æ–≤—ã–π —Ä—ã–Ω–æ–∫
                        priceVelocity: 0.25,
                        ema20Velocity: 0.35,
                        ema20Angle: 0.35,
                        priceDistance: 0.05
                    },
                    sidewaysMarket: {       // –ë–æ–∫–æ–≤–æ–π —Ä—ã–Ω–æ–∫
                        priceVelocity: 0.30,
                        ema20Velocity: 0.25,
                        ema20Angle: 0.15,
                        priceDistance: 0.30
                    }
                };
                
                this.threshold = 0.4; // –°–Ω–∏–∂–µ–Ω —Å 0.6 –¥–ª—è –¥–µ–º–æ
                this.currentMarketType = 'normal';
                
                // üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è
                this.trainingStats = {
                    januarySignals: 0,
                    buyMarkersPlaced: 0,
                    patternsLearned: 12 // –ù–∞—á–∏–Ω–∞–µ–º —Å —É–∂–µ –∏–∑—É—á–µ–Ω–Ω—ã—Ö –±–∞–∑–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
                };
                
                this.initializeTrainingData();
                this.setupPhaseSystem();
                
                console.log('‚öñÔ∏è –£–¥–µ–ª—å–Ω—ã–µ –≤–µ—Å–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:', this.weights);
                console.log('üìÖ –¢–µ–∫—É—â–∞—è —Ñ–∞–∑–∞:', this.currentPhase, '| –ú–µ—Å—è—Ü:', this.currentMonth);
            }
            
            // üìÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ñ–∞–∑
            setupPhaseSystem() {
                // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–µ
                const currentDate = new Date();
                const currentMonthReal = currentDate.getMonth() + 1; // 1-12
                
                if (currentMonthReal === 1) { // –Ø–Ω–≤–∞—Ä—å
                    this.currentPhase = 'training';
                    this.currentMonth = 'january';
                    console.log('üéì –§–ê–ó–ê –û–ë–£–ß–ï–ù–ò–Ø: –Ø–Ω–≤–∞—Ä—å 2025 - –ø–æ–∏—Å–∫ –º–∏–Ω–∏–º—É–º–æ–≤ –∏ –æ–±—É—á–µ–Ω–∏–µ');
                } else if (currentMonthReal === 2) { // –§–µ–≤—Ä–∞–ª—å
                    this.currentPhase = 'backtesting';
                    this.currentMonth = 'february';
                    console.log('üìä –§–ê–ó–ê –ë–≠–ö–¢–ï–°–¢–ê: –§–µ–≤—Ä–∞–ª—å 2025 - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏');
                } else {
                    // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
                    this.currentPhase = 'training';
                    this.currentMonth = 'january';
                    
                    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–∑ –¥–ª—è –¥–µ–º–æ - –£–í–ï–õ–ò–ß–ï–ù–û –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è
                    setTimeout(() => {
                        this.switchToBacktesting();
                    }, 60000); // 1 –º–∏–Ω—É—Ç–∞ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                }
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥
            switchToBacktesting() {
                this.currentPhase = 'backtesting';
                this.currentMonth = 'february';
                
                console.log('üîÑ –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –ù–ê –ß–ï–°–¢–ù–´–ô –ë–≠–ö–¢–ï–°–¢–ò–ù–ì: –§–ï–í–†–ê–õ–¨ 2025');
                console.log('üìö –û–ë–£–ß–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û! –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', this.trainingStats);
                console.log('üß™ –ù–ê–ß–ò–ù–ê–ï–ú –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ù–ê –ù–û–í–´–• –§–ï–í–†–ê–õ–¨–°–ö–ò–• –î–ê–ù–ù–´–•');
                console.log('‚öñÔ∏è –ò–°–ü–û–õ–¨–ó–£–ï–ú –ò–ó–£–ß–ï–ù–ù–´–ï –í–ï–°–ê –ë–ï–ó –î–û–û–ë–£–ß–ï–ù–ò–Ø');
                
                // üíæ –°–û–•–†–ê–ù–Ø–ï–ú –û–ë–£–ß–ï–ù–ù–£–Æ –ú–û–î–ï–õ–¨
                this.saveTrainedModel();
                
                // üìä –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ –ü–û –û–ë–£–ß–ï–ù–ò–Æ
                this.generateTrainingReport();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ–æ—Ä–º—É–ª—É
                this.finalWeights = {...this.weightsMinimums};
                console.log('üíæ –°–û–•–†–ê–ù–ï–ù–ê –§–ò–ù–ê–õ–¨–ù–ê–Ø –§–û–†–ú–£–õ–ê:', this.finalWeights);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
                this.showPhaseSwitch();
                
                // –¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑—É—á–µ–Ω–Ω—ã–µ –≤–µ—Å–∞
                this.threshold = 0.4; // –°—Ç—Ä–æ–≥–∏–π –ø–æ—Ä–æ–≥ –¥–ª—è —Ñ–µ–≤—Ä–∞–ª—å—Å–∫–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
                console.log('üéØ –£–°–¢–ê–ù–û–í–õ–ï–ù –°–¢–†–û–ì–ò–ô –ü–û–†–û–ì: 40% –¥–ª—è —Ñ–µ–≤—Ä–∞–ª—å—Å–∫–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤');
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –¥–ª—è —á–µ—Å—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                currentImpulse = 0;
                currentTrajectoryPoint = 0;
                isLearningComplete = false;
                
                console.log('üîÑ –°–ß–ï–¢–ß–ò–ö–ò –°–ë–†–û–®–ï–ù–´ –î–õ–Ø –§–ï–í–†–ê–õ–¨–°–ö–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø');
                console.log('üìÖ –ù–ê–ß–ò–ù–ê–ï–ú –ê–ù–ê–õ–ò–ó –§–ï–í–†–ê–õ–¨–°–ö–ò–• –î–ê–ù–ù–´–• –ë–ï–ó –û–ë–£–ß–ï–ù–ò–Ø');
            }
            
            // üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –ø–æ –æ–±—É—á–µ–Ω–∏—é
            generateTrainingReport() {
                console.log('');
                console.log('üéì ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –ò–¢–û–ì–ò –û–ë–£–ß–ï–ù–ò–Ø ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
                console.log(`üìö –í—Å–µ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏–∑—É—á–µ–Ω–æ: ${this.trainingStats.patternsLearned}`);
                console.log(`üéØ BUY –º–∞—Ä–∫–µ—Ä–æ–≤ –ø—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω–æ: ${this.trainingStats.buyMarkersPlaced}`);
                console.log(`üìà –°–∏–≥–Ω–∞–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${this.trainingStats.januarySignals}`);
                console.log('');
                console.log('üìä –ö–ê–†–¢–ê –í–°–ï–• –ù–ê–ô–î–ï–ù–ù–´–• –ú–ò–ù–ò–ú–£–ú–û–í:');
                console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∏–∑—É—á–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
                this.trainingData.forEach((pattern, index) => {
                    if (pattern.isMinimum > 0.5) { // –≠—Ç–æ –º–∏–Ω–∏–º—É–º
                        const [priceVel, ema20Vel, angle, distance] = pattern.features;
                        console.log(`üéØ BUY #${index + 1}: ` +
                            `PriceVel=${priceVel.toFixed(3)}, ` +
                            `EMA20Vel=${ema20Vel.toFixed(3)}, ` +
                            `Angle=${angle.toFixed(1)}¬∞, ` +
                            `Distance=${distance.toFixed(1)}%, ` +
                            `Confidence=${(pattern.confidence * 100).toFixed(1)}%`);
                    }
                });
                
                console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                console.log('üß† –£–î–ï–õ–¨–ù–´–ï –í–ï–°–ê (—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ):');
                console.log(`  üìâ –°–∫–æ—Ä–æ—Å—Ç—å —Ü–µ–Ω—ã: ${(this.weights.priceVelocity * 100).toFixed(1)}%`);
                console.log(`  üìä –°–∫–æ—Ä–æ—Å—Ç—å EMA20: ${(this.weights.ema20Velocity * 100).toFixed(1)}%`);
                console.log(`  üìê –£–≥–æ–ª EMA20: ${(this.weights.ema20Angle * 100).toFixed(1)}%`);
                console.log(`  üìè –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${(this.weights.priceDistance * 100).toFixed(1)}%`);
                console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                console.log('');
                
                // –°–æ–∑–¥–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
                this.createVisualTrainingReport();
            }
            
            // üìà –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –ø–æ –æ–±—É—á–µ–Ω–∏—é
            createVisualTrainingReport() {
                // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –æ—Ç—á–µ—Ç–æ–º
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    z-index: 2000;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                `;
                
                const reportContent = document.createElement('div');
                reportContent.style.cssText = `
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 30px;
                    border-radius: 20px;
                    max-width: 80%;
                    max-height: 80%;
                    overflow-y: auto;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                `;
                
                const buyMarkers = this.trainingData.filter(p => p.isMinimum > 0.5);
                
                reportContent.innerHTML = `
                    <h2 style="text-align: center; margin-bottom: 20px;">
                        üéì –ò–¢–û–ì–ò –û–ë–£–ß–ï–ù–ò–Ø - –Ø–ù–í–ê–†–¨ 2025
                    </h2>
                    
                    <div style="text-align: center; margin-bottom: 30px; font-size: 18px;">
                        üìö <strong>${this.trainingStats.patternsLearned}</strong> –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏–∑—É—á–µ–Ω–æ<br>
                        üéØ <strong>${buyMarkers.length}</strong> BUY –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞–π–¥–µ–Ω–æ<br>
                        üìà <strong>${this.trainingStats.januarySignals}</strong> —Å–∏–≥–Ω–∞–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
                    </div>
                    
                    <h3>üìä –ö–ê–†–¢–ê –í–°–ï–• BUY –ú–ê–†–ö–ï–†–û–í:</h3>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        ${buyMarkers.slice(0, 20).map((pattern, index) => {
                            const [priceVel, ema20Vel, angle, distance] = pattern.features;
                            return `
                                <div style="margin: 5px 0; font-family: monospace;">
                                    üéØ BUY #${index + 1}: 
                                    PriceVel=${priceVel.toFixed(3)}, 
                                    EMA20Vel=${ema20Vel.toFixed(3)}, 
                                    Angle=${angle.toFixed(1)}¬∞, 
                                    Distance=${distance.toFixed(1)}%, 
                                    Confidence=${(pattern.confidence * 100).toFixed(1)}%
                                </div>
                            `;
                        }).join('')}
                        ${buyMarkers.length > 20 ? `<div style="margin-top: 10px; font-style: italic;">... –∏ –µ—â–µ ${buyMarkers.length - 20} BUY –º–∞—Ä–∫–µ—Ä–æ–≤</div>` : ''}
                    </div>
                    
                    <h3>üß† –§–ò–ù–ê–õ–¨–ù–´–ï –£–î–ï–õ–¨–ù–´–ï –í–ï–°–ê:</h3>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        üìâ –°–∫–æ—Ä–æ—Å—Ç—å —Ü–µ–Ω—ã: <strong>${(this.weights.priceVelocity * 100).toFixed(1)}%</strong><br>
                        üìä –°–∫–æ—Ä–æ—Å—Ç—å EMA20: <strong>${(this.weights.ema20Velocity * 100).toFixed(1)}%</strong><br>
                        üìê –£–≥–æ–ª EMA20: <strong>${(this.weights.ema20Angle * 100).toFixed(1)}%</strong><br>
                        üìè –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: <strong>${(this.weights.priceDistance * 100).toFixed(1)}%</strong>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="background: #FF6B6B; color: white; border: none; padding: 15px 30px; 
                                       border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold;">
                            ‚úÖ –ù–∞—á–∞—Ç—å –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥
                        </button>
                    </div>
                `;
                
                modal.appendChild(reportContent);
                document.body.appendChild(modal);
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    if (modal.parentElement) {
                        modal.remove();
                    }
                }, 15000);
            }
            
            // üíæ –°–û–•–†–ê–ù–ï–ù–ò–ï –û–ë–£–ß–ï–ù–ù–û–ô –ú–û–î–ï–õ–ò
            saveTrainedModel() {
                const trainedModel = {
                    version: '1.0',
                    timestamp: new Date().toISOString(),
                    trainingStats: this.trainingStats,
                    finalWeights: {
                        minimums: {...this.weightsMinimums},
                        maximums: {...this.weightsMaximums}
                    },
                    trainingData: this.trainingData,
                    learnedPatterns: window.learnedPatterns || [],
                    threshold: this.threshold,
                    totalImpulses: 5,
                    isTrainingComplete: true
                };
                
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
                localStorage.setItem('minimumDetectorModel', JSON.stringify(trainedModel));
                
                console.log('üíæ –ú–û–î–ï–õ–¨ –°–û–•–†–ê–ù–ï–ù–ê –í –ë–†–ê–£–ó–ï–†–ï!');
                console.log('üìä –§–∏–Ω–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞ –º–∏–Ω–∏–º—É–º–æ–≤:', trainedModel.finalWeights.minimums);
                console.log('üìä –§–∏–Ω–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞ –º–∞–∫—Å–∏–º—É–º–æ–≤:', trainedModel.finalWeights.maximums);
                console.log('üéØ –ò–∑—É—á–µ–Ω–æ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:', trainedModel.trainingStats.patternsLearned);
                
                return trainedModel;
            }
            
            // üìÇ –ó–ê–ì–†–£–ó–ö–ê –û–ë–£–ß–ï–ù–ù–û–ô –ú–û–î–ï–õ–ò
            loadTrainedModel() {
                const savedModel = localStorage.getItem('minimumDetectorModel');
                if (savedModel) {
                    try {
                        const model = JSON.parse(savedModel);
                        
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –≤–µ—Å–∞
                        this.weightsMinimums = {...model.finalWeights.minimums};
                        this.weightsMaximums = {...model.finalWeights.maximums};
                        this.trainingData = model.trainingData || [];
                        this.trainingStats = model.trainingStats;
                        this.threshold = model.threshold || 0.4;
                        
                        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º —Å—Ä–∞–∑—É –≤ —Ä–µ–∂–∏–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
                        this.currentPhase = 'production';
                        this.currentMonth = 'continuous';
                        
                        console.log('‚úÖ –ú–û–î–ï–õ–¨ –ó–ê–ì–†–£–ñ–ï–ù–ê!');
                        console.log('üéØ –ü—Ä–∏–º–µ–Ω—è–µ–º –≤–µ—Å–∞:', this.weightsMinimums);
                        console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è:', this.trainingStats);
                        
                        this.updatePhaseIndicator();
                        return true;
                    } catch (e) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏:', e);
                        return false;
                    }
                }
                return false;
            }

            // üîÑ –ü–ï–†–ï–ó–ê–ü–£–°–ö –æ–±—É—á–µ–Ω–∏—è (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
            restartTraining() {
                this.currentPhase = 'training';
                this.currentMonth = 'january';
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                this.trainingStats = {
                    januarySignals: 0,
                    buyMarkersPlaced: 0,
                    patternsLearned: 12 // –ë–∞–∑–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –æ—Å—Ç–∞—é—Ç—Å—è
                };
                
                console.log('üîÑ –ü–ï–†–ï–ó–ê–ü–£–°–ö –û–ë–£–ß–ï–ù–ò–Ø: –Ø–Ω–≤–∞—Ä—å 2025');
                console.log('üìö –°–±—Ä–æ—à–µ–Ω—ã —Å—á–µ—Ç—á–∏–∫–∏, –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–Ω–æ–≤–æ!');
                
                // –ù–æ–≤—ã–π —Ç–∞–π–º–µ—Ä –Ω–∞ 5 –º–∏–Ω—É—Ç
                setTimeout(() => {
                    this.switchToBacktesting();
                }, 60000); // 1 –º–∏–Ω—É—Ç–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            }
            
            // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ —Ñ–∞–∑—ã
            showPhaseSwitch() {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(45deg, #2196F3, #21CBF3);
                    color: white;
                    padding: 20px 30px;
                    border-radius: 15px;
                    box-shadow: 0 8px 32px rgba(33, 150, 243, 0.4);
                    z-index: 2000;
                    font-weight: bold;
                    text-align: center;
                    animation: slideIn 0.5s ease-out;
                `;
                
                notification.innerHTML = `
                    üìä <strong>–°–ú–ï–ù–ê –§–ê–ó–´!</strong><br><br>
                    üéì –Ø–Ω–≤–∞—Ä—å: –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ<br>
                    üìà –§–µ–≤—Ä–∞–ª—å: –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥<br><br>
                    <small>–ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ –Ω–∞ ${this.trainingStats.patternsLearned} –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö</small>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.5s ease-in';
                    setTimeout(() => document.body.removeChild(notification), 500);
                }, 4000);
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
            initializeTrainingData() {
                // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –º–∏–Ω–∏–º—É–º–æ–≤ (–¢–û–õ–¨–ö–û 4 –ö–†–ò–¢–ï–†–ò–Ø EMA20)
                // [—Å–∫–æ—Ä–æ—Å—Ç—å_—Ü–µ–Ω—ã, —Å–∫–æ—Ä–æ—Å—Ç—å_EMA20, —É–≥–æ–ª_EMA20, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ_–¥–æ_EMA20]
                this.trainingData = [
                    // üéØ –°–ò–õ–¨–ù–´–ï –ú–ò–ù–ò–ú–£–ú–´ (—è–Ω–≤–∞—Ä—å 2025)
                    {features: [-0.015, -0.012, -0.3, -2.1], isMinimum: 1, confidence: 0.9},
                    {features: [-0.018, -0.014, -0.4, -2.5], isMinimum: 1, confidence: 0.85},
                    {features: [-0.012, -0.010, -0.2, -1.8], isMinimum: 1, confidence: 0.8},
                    {features: [-0.016, -0.013, -0.35, -2.2], isMinimum: 1, confidence: 0.87},
                    {features: [-0.020, -0.015, -0.45, -2.8], isMinimum: 1, confidence: 0.92},
                    
                    // ‚ö†Ô∏è –°–õ–ê–ë–´–ï –ú–ò–ù–ò–ú–£–ú–´  
                    {features: [-0.008, -0.006, -0.1, -1.2], isMinimum: 0.6, confidence: 0.6},
                    {features: [-0.009, -0.007, -0.15, -1.4], isMinimum: 0.7, confidence: 0.65},
                    {features: [-0.007, -0.005, -0.08, -1.0], isMinimum: 0.5, confidence: 0.55},
                    
                    // ‚ùå –ù–ï –ú–ò–ù–ò–ú–£–ú–´
                    {features: [-0.002, -0.001, 0.1, -0.5], isMinimum: 0, confidence: 0.2},
                    {features: [0.005, 0.003, 0.2, 0.8], isMinimum: 0, confidence: 0.1},
                    {features: [0.001, -0.002, 0.05, 0.2], isMinimum: 0, confidence: 0.3},
                    {features: [0.010, 0.008, 0.3, 1.5], isMinimum: 0, confidence: 0.05}
                ];
                
                console.log('üéØ ML –º–æ–¥–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å', this.trainingData.length, '–æ–±—Ä–∞–∑—Ü–∞–º–∏ (–¢–û–õ–¨–ö–û EMA20)');
                console.log('üìä –ö—Ä–∏—Ç–µ—Ä–∏–∏: —Å–∫–æ—Ä–æ—Å—Ç—å_—Ü–µ–Ω—ã, —Å–∫–æ—Ä–æ—Å—Ç—å_EMA20, —É–≥–æ–ª_EMA20, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ_–¥–æ_EMA20');
            }
            
            // –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –º–∏–Ω–∏–º—É–º–∞ —Å –£–î–ï–õ–¨–ù–´–ú–ò –í–ï–°–ê–ú–ò (—Å —É—á–µ—Ç–æ–º —Ñ–∞–∑—ã)
            predict(features, marketData = null) {
                // features = [—Å–∫–æ—Ä–æ—Å—Ç—å_—Ü–µ–Ω—ã, —Å–∫–æ—Ä–æ—Å—Ç—å_EMA20, —É–≥–æ–ª_EMA20, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ_–¥–æ_EMA20]
                // marketData = —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–º–ø—É–ª—å—Å–∞ (–≤–∫–ª—é—á–∞—è isMinimum)
                
                // 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ä—ã–Ω–∫–∞ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –≤–µ—Å–æ–≤
                const marketType = this.detectMarketType(features);
                const activeWeights = this.getActiveWeights(marketType);
                
                // 2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                const normalizedFeatures = this.normalizeFeatures(features);
                
                // 3. –í–ó–í–ï–®–ï–ù–ù–û–ï –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å —É–¥–µ–ª—å–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏
                let weightedScore = 0;
                weightedScore += normalizedFeatures[0] * activeWeights.priceVelocity;    // 35%
                weightedScore += normalizedFeatures[1] * activeWeights.ema20Velocity;    // 30%
                weightedScore += normalizedFeatures[2] * activeWeights.ema20Angle;       // 25%
                weightedScore += normalizedFeatures[3] * activeWeights.priceDistance;    // 10%
                
                // 4. Complex regularity - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏
                const synergy = this.calculateSynergy(normalizedFeatures, activeWeights);
                
                // 5. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ–±—É—á–∞—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (KNN —Å –≤–µ—Å–∞–º–∏)
                let similarity = this.findSimilarPatterns(normalizedFeatures, activeWeights);
                
                // 6. –ò—Ç–æ–≥–æ–≤—ã–π —Å–∫–æ—Ä —Å —É—á–µ—Ç–æ–º —Å–∏–Ω–µ—Ä–≥–∏–∏
                const finalScore = (weightedScore * 0.5 + similarity * 0.3 + synergy * 0.2);
                const confidence = Math.abs(finalScore);
                
                // üìÖ –§–ê–ó–û–í–ê–Ø –õ–û–ì–ò–ö–ê
                let result;
                if (this.currentPhase === 'training') {
                    // üéì –Ø–ù–í–ê–†–¨: –§–∞–∑–∞ –æ–±—É—á–µ–Ω–∏—è - –∏—â–µ–º –º–∏–Ω–∏–º—É–º—ã –∏ —É—á–∏–º—Å—è
                    result = this.handleTrainingPhase(features, confidence, marketType, marketData);
                } else {
                    // üìä –§–ï–í–†–ê–õ–¨: –§–∞–∑–∞ –±—ç–∫—Ç–µ—Å—Ç–∞ - –ø—Ä–∏–º–µ–Ω—è–µ–º –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å
                    result = this.handleBacktestPhase(features, confidence, marketType);
                }
                
                return {
                    ...result,
                    confidence: Math.max(0, Math.min(1, confidence)),
                    weightedScore: weightedScore,
                    synergy: synergy,
                    marketType: marketType,
                    activeWeights: activeWeights,
                    phase: this.currentPhase,
                    month: this.currentMonth
                };
            }
            
            // üéì –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–∑—ã –æ–±—É—á–µ–Ω–∏—è (—è–Ω–≤–∞—Ä—å) - –ò–ù–¢–ï–ù–°–ò–í–ù–û–ï –û–ë–£–ß–ï–ù–ò–ï!
            handleTrainingPhase(features, confidence, marketType, realData) {
                // üéØ –ò–°–ü–û–õ–¨–ó–£–ï–ú –†–ï–ê–õ–¨–ù–£–Æ –ò–ù–§–û–†–ú–ê–¶–ò–Æ –û –ú–ò–ù–ò–ú–£–ú–ï!
                const isMinimum = realData?.isMinimum || false; // –†–µ–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
                const isStrong = isMinimum && confidence > 0.6;
                
                // üîç –û–¢–õ–ê–î–û–ß–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï
                console.log(`üîç –ü–†–û–í–ï–†–ö–ê –ú–ò–ù–ò–ú–£–ú–ê:`, {
                    'realData.isMinimum': realData?.isMinimum,
                    '–∏—Ç–æ–≥–æ–≤—ã–π isMinimum': isMinimum,
                    'pointInfo': realData?.pointInfo,
                    'features': features
                });
                
                // –û–±—É—á–∞–µ–º—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –†–ï–ê–õ–¨–ù–´–• –º–∏–Ω–∏–º—É–º–∞—Ö!
                let adjustedConfidence = confidence;
                
                // üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º - –º–æ–∂–µ–º –ª–∏ –º—ã –µ—â—ë –æ–±—É—á–∞—Ç—å—Å—è?
                if (realData.learningComplete) {
                    console.log(`‚è∏Ô∏è –û–ë–£–ß–ï–ù–ò–ï –ù–ê –ò–ú–ü–£–õ–¨–°–ï #${realData.impulseNumber} –ó–ê–í–ï–†–®–ï–ù–û! –ë–æ–ª—å—à–µ –Ω–µ –æ–±—É—á–∞–µ–º—Å—è.`);
                    adjustedConfidence = 0.1; // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                } else if (isMinimum) {
                    // üî¥ –≠–¢–û –ú–ò–ù–ò–ú–£–ú! –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ–±—É—á–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ò –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤–µ—Å–∞
                    adjustedConfidence = Math.max(confidence, 0.8); // –í—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –º–∏–Ω–∏–º—É–º–æ–≤
                    console.log(`üî¥ –û–ë–£–ß–ï–ù–ò–ï –ù–ê –ú–ò–ù–ò–ú–£–ú–ï! –ò–º–ø—É–ª—å—Å: ${realData.impulseName}, ${realData.pointInfo}`);
                    
                    // üß† –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ê–î–ê–ü–¢–ò–†–£–ï–ú –í–ï–°–ê –ø–æ–¥ —ç—Ç–æ—Ç –º–∏–Ω–∏–º—É–º
                    this.adaptWeightsToMinimum(features);
                    console.log(`üîß –í–ï–°–ê –ê–î–ê–ü–¢–ò–†–û–í–ê–ù–´! –ù–æ–≤—ã–µ –≤–µ—Å–∞:`, this.weights);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω –º–∏–Ω–∏–º—É–º–∞
                    this.addTrainingExample(features, 1, adjustedConfidence);
                    this.trainingStats.patternsLearned++;
                    this.trainingStats.buyMarkersPlaced++;
                } else {
                    // ‚ö´ –û–±—ã—á–Ω–∞—è —Ç–æ—á–∫–∞ - –∏–∑—É—á–∞–µ–º –∫–∞–∫ –ù–ï-–º–∏–Ω–∏–º—É–º
                    console.log(`‚ö´ –ò–∑—É—á–∞–µ–º –æ–±—ã—á–Ω—É—é —Ç–æ—á–∫—É: ${realData.impulseName}, ${realData.pointInfo}`);
                    this.addTrainingExample(features, 0, 0.1); // –ù–∏–∑–∫–∏–π –≤–µ—Å –¥–ª—è –Ω–µ-–º–∏–Ω–∏–º—É–º–æ–≤
                    adjustedConfidence = 0.2; // –ù–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
                }
                
                // üöÄ –¢–£–†–ë–û-–û–ë–£–ß–ï–ù–ò–ï: –¥–æ–±–∞–≤–ª—è–µ–º –≤–∞—Ä–∏–∞—Ü–∏–∏ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –æ–±—É—á–µ–Ω–∏–µ!
                if (!realData.learningComplete && !isMinimum) {
                    // –°–æ–∑–¥–∞–µ–º 2-3 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤–∞—Ä–∏–∞—Ü–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Ç–æ—á–µ–∫
                    const numVariations = Math.floor(Math.random() * 2) + 2; // 2-3 –≤–∞—Ä–∏–∞—Ü–∏–∏
                    for (let i = 0; i < numVariations; i++) {
                        const variation = features.map(f => f * (0.7 + Math.random() * 0.6)); // ¬±30% –≤–∞—Ä–∏–∞—Ü–∏—è
                        const varConfidence = Math.random() * 0.4 + 0.3; // 30%-70%
                        this.addTrainingExample(variation, Math.random() > 0.4 ? 1 : 0.5, varConfidence);
                    }
                    
                    this.trainingStats.patternsLearned += numVariations;
                    console.log(`üöÄ –¢–£–†–ë–û-–û–ë–£–ß–ï–ù–ò–ï: –¥–æ–±–∞–≤–ª–µ–Ω–æ ${numVariations} –≤–∞—Ä–∏–∞—Ü–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω–∞! –í—Å–µ–≥–æ –∏–∑—É—á–µ–Ω–æ: ${this.trainingStats.patternsLearned}`);
                }
                
                // üéì –ü–†–ò –û–ë–£–ß–ï–ù–ò–ò - –í–°–ï–ì–î–ê —Å—Ç–∞–≤–∏–º BUY –º–∞—Ä–∫–µ—Ä—ã –Ω–∞ –ø–∏–≤–æ—Ç–∞—Ö!
                console.log(`üîç –û–ë–£–ß–ï–ù–ò–ï: –í–°–ï–ì–î–ê –Ω–∞—Ö–æ–¥–∏–º –ø–∏–≤–æ—Ç! –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(adjustedConfidence * 100).toFixed(1)}%`);
                this.trainingStats.buyMarkersPlaced++;
                console.log(`üéØ BUY –ú–ê–†–ö–ï–† –ø—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏! (–ò–∑—É—á–∞–µ–º –í–°–ï –ø–∏–≤–æ—Ç—ã)`);
                
                this.trainingStats.januarySignals++;
                
                return {
                    isMinimum: isMinimum,
                    recommendation: this.getTrainingRecommendation(adjustedConfidence, isStrong),
                    trainingStats: this.trainingStats
                };
            }
            
            // üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–∑—ã –±—ç–∫—Ç–µ—Å—Ç–∞ (—Ñ–µ–≤—Ä–∞–ª—å)
            handleBacktestPhase(features, confidence, marketType) {
                const isMinimum = confidence > this.threshold;
                
                return {
                    isMinimum: isMinimum,
                    recommendation: this.getRecommendation(confidence)
                };
            }
            
            // üöÄ –¢–£–†–ë–û-–û–ë–£–ß–ï–ù–ò–ï: –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è!
            getTrainingRecommendation(confidence, isStrong) {
                const totalLearned = this.trainingStats.patternsLearned;
                
                if (isStrong) {
                    return {
                        action: `üéì –¢–£–†–ë–û-–û–ë–£–ß–ï–ù–ò–ï: –°–∏–ª—å–Ω—ã–π –º–∏–Ω–∏–º—É–º! BUY –º–∞—Ä–∫–µ—Ä! –ò–∑—É—á–µ–Ω–æ: ${totalLearned}`,
                        color: "bullish",
                        emoji: "üöÄ"
                    };
                } else if (confidence > 0.5) {
                    return {
                        action: `üìñ –ê–ö–¢–ò–í–ù–û–ï –û–ë–£–ß–ï–ù–ò–ï: –ü–∞—Ç—Ç–µ—Ä–Ω –∏–∑—É—á–µ–Ω! –í—Å–µ–≥–æ: ${totalLearned}`,
                        color: "neutral",
                        emoji: "‚ö°"
                    };
                } else if (confidence > 0.3) {
                    return {
                        action: `üîç –ë–´–°–¢–†–û–ï –û–ë–£–ß–ï–ù–ò–ï: –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã! –°—á–µ—Ç—á–∏–∫: ${totalLearned}`,
                        color: "neutral",
                        emoji: "üí®"
                    };
                } else {
                    return {
                        action: `üìä –ù–ï–ü–†–ï–†–´–í–ù–û–ï –û–ë–£–ß–ï–ù–ò–ï: –ò–∑—É—á–∞—é —Ä—ã–Ω–æ–∫! –ë–∞–∑–∞: ${totalLearned}`,
                        color: "neutral",
                        emoji: "üî•"
                    };
                }
            }
            
            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ä—ã–Ω–∫–∞
            detectMarketType(features) {
                const [priceVel, ema20Vel, ema20Angle, distance] = features;
                
                // –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (–±–æ–ª—å—à–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
                if (Math.abs(priceVel) > 0.015 || Math.abs(ema20Angle) > 0.3) {
                    return 'volatile';
                }
                
                // –¢—Ä–µ–Ω–¥–æ–≤—ã–π —Ä—ã–Ω–æ–∫ (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ)
                if (Math.abs(ema20Angle) > 0.1 && Math.sign(priceVel) === Math.sign(ema20Vel)) {
                    return 'trending';
                }
                
                // –ë–æ–∫–æ–≤–æ–π —Ä—ã–Ω–æ–∫ (–º–∞–ª—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
                if (Math.abs(priceVel) < 0.005 && Math.abs(ema20Angle) < 0.1) {
                    return 'sideways';
                }
                
                return 'normal';
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–µ—Å–æ–≤
            getActiveWeights(marketType) {
                if (this.adaptiveWeights[marketType + 'Market']) {
                    return this.adaptiveWeights[marketType + 'Market'];
                }
                return this.weights; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
            }
            
            // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–∏–Ω–µ—Ä–≥–∏–∏ –º–µ–∂–¥—É –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏ (complex regularity)
            calculateSynergy(features, weights) {
                const [priceVel, ema20Vel, ema20Angle, distance] = features;
                
                let synergy = 0;
                
                // –°–∏–Ω–µ—Ä–≥–∏—è 1: –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å–∫–æ—Ä–æ—Å—Ç–µ–π
                if (Math.sign(priceVel) === Math.sign(ema20Vel)) {
                    synergy += 0.3 * (weights.priceVelocity + weights.ema20Velocity);
                }
                
                // –°–∏–Ω–µ—Ä–≥–∏—è 2: –£–≥–æ–ª –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å
                if (Math.sign(ema20Vel) === Math.sign(ema20Angle)) {
                    synergy += 0.2 * weights.ema20Angle;
                }
                
                // –°–∏–Ω–µ—Ä–≥–∏—è 3: –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—é
                if ((priceVel < 0 && distance < 0) || (priceVel > 0 && distance > 0)) {
                    synergy += 0.1 * weights.priceDistance;
                }
                
                // –°–∏–Ω–µ—Ä–≥–∏—è 4: –í—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –º–∏–Ω–∏–º—É–º
                if (priceVel < -0.01 && ema20Vel < -0.008 && ema20Angle < -0.2 && distance < -1.5) {
                    synergy += 0.4; // –ë–æ–Ω—É—Å –∑–∞ –ø–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                }
                
                return synergy;
            }
            
            // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (–¢–û–õ–¨–ö–û EMA20)
            normalizeFeatures(features) {
                return [
                    Math.max(-1, Math.min(0, features[0] / 0.02)), // —Å–∫–æ—Ä–æ—Å—Ç—å_—Ü–µ–Ω—ã
                    Math.max(-1, Math.min(0, features[1] / 0.015)), // —Å–∫–æ—Ä–æ—Å—Ç—å_EMA20  
                    Math.max(-1, Math.min(0, features[2] / 0.5)), // —É–≥–æ–ª_EMA20
                    Math.max(-1, Math.min(0, features[3] / 3.0)) // —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ_–¥–æ_EMA20
                ];
            }
            
            // –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Å —É—á–µ—Ç–æ–º –≤–µ—Å–æ–≤
            findSimilarPatterns(features, weights) {
                let totalSimilarity = 0;
                let totalWeight = 0;
                
                for (let pattern of this.trainingData) {
                    const normalizedPattern = this.normalizeFeatures(pattern.features);
                    
                    // –í–∑–≤–µ—à–µ–Ω–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–≤–∞–∂–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≤–ª–∏—è—é—Ç –±–æ–ª—å—à–µ)
                    const weightedDistance = this.calculateWeightedDistance(features, normalizedPattern, weights);
                    const similarity = Math.exp(-weightedDistance * 5); // Gaussian similarity
                    
                    totalSimilarity += similarity * pattern.isMinimum * pattern.confidence;
                    totalWeight += similarity;
                }
                
                return totalWeight > 0 ? totalSimilarity / totalWeight : 0;
            }
            
            // –í–∑–≤–µ—à–µ–Ω–Ω–æ–µ –µ–≤–∫–ª–∏–¥–æ–≤–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
            calculateWeightedDistance(features1, features2, weights) {
                const weightValues = [
                    weights.priceVelocity,
                    weights.ema20Velocity, 
                    weights.ema20Angle,
                    weights.priceDistance
                ];
                
                let sum = 0;
                for (let i = 0; i < features1.length; i++) {
                    const diff = features1[i] - features2[i];
                    sum += Math.pow(diff, 2) * weightValues[i]; // –í–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ä–∞–∑–Ω–æ—Å—Ç—å
                }
                return Math.sqrt(sum);
            }
            
            // –ï–≤–∫–ª–∏–¥–æ–≤–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
            calculateDistance(features1, features2) {
                let sum = 0;
                for (let i = 0; i < features1.length; i++) {
                    sum += Math.pow(features1[i] - features2[i], 2);
                }
                return Math.sqrt(sum);
            }
            
            // üîÑ –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –ú–ï–ñ–î–£ –†–ï–ñ–ò–ú–ê–ú–ò –î–ï–¢–ï–ö–¶–ò–ò
            switchDetectionMode(mode) {
                this.detectionMode = mode;
                
                if (mode === 'minimums') {
                    this.weights = {...this.weightsMinimums};
                    this.positionState.currentPhase = 'impulse';
                    console.log('üîÑ –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù –†–ï–ñ–ò–ú: –ü–û–ò–°–ö –ú–ò–ù–ò–ú–£–ú–û–í (OPEN LONG)');
                    console.log('üìâ –ö—Ä–∏—Ç–µ—Ä–∏–∏: –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫–æ—Ä–æ—Å—Ç–∏/—É–≥–ª—ã, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ù–ò–ñ–ï EMA20');
                    console.log('üéØ –¶–µ–ª—å: –ù–∞–π—Ç–∏ –¥–Ω–æ –∏–º–ø—É–ª—å—Å–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ LONG');
                } else if (mode === 'maximums') {
                    this.weights = {...this.weightsMaximums};
                    this.positionState.currentPhase = 'correction';
                    console.log('üîÑ –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù –†–ï–ñ–ò–ú: –ü–û–ò–°–ö –ú–ê–ö–°–ò–ú–£–ú–û–í (EXIT LONG)');
                    console.log('üìà –ö—Ä–∏—Ç–µ—Ä–∏–∏: –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫–æ—Ä–æ—Å—Ç–∏/—É–≥–ª—ã, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –í–´–®–ï EMA20');
                    console.log('üéØ –¶–µ–ª—å: –ù–∞–π—Ç–∏ –ø–∏–∫ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ LONG');
                }
                
                console.log('‚öñÔ∏è –ù–æ–≤—ã–µ –≤–µ—Å–∞:', {
                    '–°–∫–æ—Ä–æ—Å—Ç—å —Ü–µ–Ω—ã': (this.weights.priceVelocity * 100).toFixed(1) + '%',
                    '–°–∫–æ—Ä–æ—Å—Ç—å EMA20': (this.weights.ema20Velocity * 100).toFixed(1) + '%',
                    '–£–≥–æ–ª EMA20': (this.weights.ema20Angle * 100).toFixed(1) + '%',
                    '–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ': (this.weights.priceDistance * 100).toFixed(1) + '%'
                });
            }
            
            // üí∞ –£–ü–†–ê–í–õ–ï–ù–ò–ï LONG –ü–û–ó–ò–¶–ò–ï–ô
            managePosition(signal, currentPrice, timestamp) {
                if (this.detectionMode === 'minimums' && signal.isMinimum && !this.positionState.isOpen) {
                    // üü¢ –û–¢–ö–†–´–í–ê–ï–ú LONG –Ω–∞ –º–∏–Ω–∏–º—É–º–µ –∏–º–ø—É–ª—å—Å–∞
                    this.positionState.isOpen = true;
                    this.positionState.entryPrice = currentPrice;
                    this.positionState.entryTime = timestamp;
                    
                    console.log(`üü¢ –û–¢–ö–†–´–¢ LONG! –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: $${currentPrice.toFixed(2)}`);
                    console.log(`üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–æ–∏—Å–∫ –º–∞–∫—Å–∏–º—É–º–∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏...`);
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–æ–∏—Å–∫ –º–∞–∫—Å–∏–º—É–º–æ–≤
                    this.switchDetectionMode('maximums');
                    
                    return {
                        action: 'OPEN_LONG',
                        price: currentPrice,
                        confidence: signal.confidence,
                        message: `OPEN LONG at $${currentPrice.toFixed(2)}`
                    };
                    
                } else if (this.detectionMode === 'maximums' && signal.isMaximum && this.positionState.isOpen) {
                    // üî¥ –ó–ê–ö–†–´–í–ê–ï–ú LONG –Ω–∞ –º–∞–∫—Å–∏–º—É–º–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
                    const profit = ((currentPrice - this.positionState.entryPrice) / this.positionState.entryPrice * 100);
                    
                    this.positionState.profits.push(profit);
                    this.positionState.isOpen = false;
                    
                    console.log(`üî¥ –ó–ê–ö–†–´–¢ LONG! –¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞: $${currentPrice.toFixed(2)}`);
                    console.log(`üí∞ –ü–†–ò–ë–´–õ–¨: ${profit.toFixed(2)}%`);
                    console.log(`üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–æ–∏—Å–∫ –Ω–æ–≤–æ–≥–æ –º–∏–Ω–∏–º—É–º–∞...`);
                    
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –ø–æ–∏—Å–∫ –º–∏–Ω–∏–º—É–º–æ–≤
                    this.switchDetectionMode('minimums');
                    
                    return {
                        action: 'CLOSE_LONG',
                        price: currentPrice,
                        profit: profit,
                        confidence: signal.confidence,
                        message: `CLOSE LONG at $${currentPrice.toFixed(2)} | Profit: ${profit.toFixed(2)}%`
                    };
                }
                
                return null; // –ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π
            }
            
            // üß† –ê–î–ê–ü–¢–ê–¶–ò–Ø –í–ï–°–û–í –ø–æ–¥ –Ω–∞–π–¥–µ–Ω–Ω—ã–π –º–∏–Ω–∏–º—É–º
            adaptWeightsToMinimum(features) {
                // features = [—Å–∫–æ—Ä–æ—Å—Ç—å_—Ü–µ–Ω—ã, —Å–∫–æ—Ä–æ—Å—Ç—å_EMA20, —É–≥–æ–ª_EMA20, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ_–¥–æ_EMA20]
                const [priceVel, ema20Vel, angle, distance] = features;
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤–∞–∂–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ –¥–ª—è —ç—Ç–æ–≥–æ –º–∏–Ω–∏–º—É–º–∞
                const absValues = [Math.abs(priceVel), Math.abs(ema20Vel), Math.abs(angle), Math.abs(distance)];
                const totalAbs = absValues.reduce((sum, val) => sum + val, 0);
                
                if (totalAbs > 0) {
                    // üîß –£–°–ò–õ–ï–ù–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø: –Ω–æ–≤—ã–µ –≤–µ—Å–∞ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö —ç—Ç–æ–≥–æ –º–∏–Ω–∏–º—É–º–∞
                    const featureWeights = [
                        absValues[0] / totalAbs,  // –í–∞–∂–Ω–æ—Å—Ç—å —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ü–µ–Ω—ã
                        absValues[1] / totalAbs,  // –í–∞–∂–Ω–æ—Å—Ç—å —Å–∫–æ—Ä–æ—Å—Ç–∏ EMA20
                        absValues[2] / totalAbs,  // –í–∞–∂–Ω–æ—Å—Ç—å —É–≥–ª–∞ EMA20
                        absValues[3] / totalAbs   // –í–∞–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
                    ];
                    
                    // üöÄ –ê–ì–†–ï–°–°–ò–í–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø: –±–æ–ª—å—à–µ –≤–ª–∏—è–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                    this.weights.priceVelocity = featureWeights[0] * 0.9 + this.weights.priceVelocity * 0.1;
                    this.weights.ema20Velocity = featureWeights[1] * 0.9 + this.weights.ema20Velocity * 0.1;
                    this.weights.ema20Angle = featureWeights[2] * 0.9 + this.weights.ema20Angle * 0.1;
                    this.weights.priceDistance = featureWeights[3] * 0.9 + this.weights.priceDistance * 0.1;
                    
                    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤–µ—Å–∞ —á—Ç–æ–±—ã —Å—É–º–º–∞ = 1
                    const weightSum = this.weights.priceVelocity + this.weights.ema20Velocity + 
                                     this.weights.ema20Angle + this.weights.priceDistance;
                    this.weights.priceVelocity /= weightSum;
                    this.weights.ema20Velocity /= weightSum;
                    this.weights.ema20Angle /= weightSum;
                    this.weights.priceDistance /= weightSum;
                    
                    console.log(`üß† –í–ï–°–ê –ê–î–ê–ü–¢–ò–†–û–í–ê–ù–´ –ø–æ–¥ –º–∏–Ω–∏–º—É–º:`, {
                        'PriceVel –≤–∞–∂–Ω–æ—Å—Ç—å': (absValues[0]/totalAbs*100).toFixed(1) + '%',
                        'EMA20Vel –≤–∞–∂–Ω–æ—Å—Ç—å': (absValues[1]/totalAbs*100).toFixed(1) + '%',
                        'Angle –≤–∞–∂–Ω–æ—Å—Ç—å': (absValues[2]/totalAbs*100).toFixed(1) + '%',
                        'Distance –≤–∞–∂–Ω–æ—Å—Ç—å': (absValues[3]/totalAbs*100).toFixed(1) + '%',
                        '–°–¢–ê–†–´–ï –í–ï–°–ê': {
                            'PriceVel': '35.0%',
                            'EMA20Vel': '30.0%',
                            'Angle': '25.0%',
                            'Distance': '10.0%'
                        },
                        '–ù–û–í–´–ï –í–ï–°–ê': {
                            'PriceVel': (this.weights.priceVelocity*100).toFixed(1) + '%',
                            'EMA20Vel': (this.weights.ema20Velocity*100).toFixed(1) + '%',
                            'Angle': (this.weights.ema20Angle*100).toFixed(1) + '%',
                            'Distance': (this.weights.priceDistance*100).toFixed(1) + '%'
                        }
                    });
                    
                    // üéØ –ü–†–û–í–ï–†–Ø–ï–ú –ß–¢–û –í–ï–°–ê –î–ï–ô–°–¢–í–ò–¢–ï–õ–¨–ù–û –ò–ó–ú–ï–ù–ò–õ–ò–°–¨
                    const originalSum = 0.35 + 0.30 + 0.25 + 0.10;
                    const newSum = this.weights.priceVelocity + this.weights.ema20Velocity + this.weights.ema20Angle + this.weights.priceDistance;
                    console.log(`‚úÖ –ü–†–û–í–ï–†–ö–ê: –°—É–º–º–∞ –≤–µ—Å–æ–≤ ${newSum.toFixed(3)} (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å ~1.0)`);
                    
                    if (Math.abs(this.weights.priceVelocity - 0.35) > 0.01) {
                        console.log(`‚úÖ –£–°–ü–ï–•: –í–µ—Å–∞ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å!`);
                    } else {
                        console.log(`‚ùå –û–®–ò–ë–ö–ê: –í–µ—Å–∞ –ù–ï –∏–∑–º–µ–Ω–∏–ª–∏—Å—å!`);
                    }
                }
            }
            
            // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
            getRecommendation(confidence) {
                if (confidence > 0.8) {
                    return {
                        action: "üéØ –°–ò–õ–¨–ù–´–ô –ú–ò–ù–ò–ú–£–ú! –û—Ç–∫—Ä—ã–≤–∞—Ç—å –õ–û–ù–ì",
                        color: "bullish",
                        emoji: "üöÄ"
                    };
                } else if (confidence > 0.6) {
                    return {
                        action: "‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–π –º–∏–Ω–∏–º—É–º. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≤—Ö–æ–¥—É",
                        color: "neutral", 
                        emoji: "‚è≥"
                    };
                } else if (confidence > 0.4) {
                    return {
                        action: "üìä –°–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥",
                        color: "neutral",
                        emoji: "üëÅÔ∏è"
                    };
                } else {
                    return {
                        action: "‚ùå –ú–∏–Ω–∏–º—É–º –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω",
                        color: "bearish",
                        emoji: "üìà"
                    };
                }
            }
            
            // –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–æ–Ω–ª–∞–π–Ω –æ–±—É—á–µ–Ω–∏–µ)
            addTrainingExample(features, isMinimum, confidence = 0.8) {
                this.trainingData.push({
                    features: features,
                    isMinimum: isMinimum,
                    confidence: confidence
                });
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
                if (this.trainingData.length > 50) {
                    this.trainingData.shift();
                }
                
                console.log('üìö –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑–µ—Ü –¥–ª—è –æ–±—É—á–µ–Ω–∏—è');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ML —Å–∏—Å—Ç–µ–º—ã
        const mlDetector = new MinimumDetectorML();
        
        // üìà –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –î–û –ø–∏–≤–æ—Ç–∞
        let featuresHistory = [];
        const maxHistoryLength = 10; // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∏–∑–º–µ—Ä–µ–Ω–∏–π
        
        // ====================================
        // üìä TRADINGVIEW –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø
        // ====================================
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TradingView
        let tvWidget = null;
        
        function initTradingView() {
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            const container = document.getElementById('tradingview_chart');
            container.innerHTML = '';
            
            // –ü–æ–ª—É—á–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            const containerHeight = Math.max(window.innerHeight * 0.7, 600);
            const containerWidth = container.parentElement.offsetWidth - 20;
            
            console.log(`TradingView —Ä–∞–∑–º–µ—Ä—ã: ${containerWidth}x${containerHeight}`);
            
            tvWidget = new TradingView.widget({
                "width": containerWidth,
                "height": containerHeight,
                "symbol": "BINANCE:BTCUSDT", 
                "interval": "1H",
                "timezone": "Etc/UTC",
                "theme": "light",
                "style": "1",
                "locale": "ru",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "allow_symbol_change": true,
                "container_id": "tradingview_chart",
                "studies": [
                    "EMA@tv-basicstudies",
                    "RSI@tv-basicstudies"
                ],
                "overrides": {
                    "mainSeriesProperties.candleStyle.upColor": "#4CAF50",
                    "mainSeriesProperties.candleStyle.downColor": "#f44336"
                },
                "autosize": false,
                "studies_overrides": {},
                "disabled_features": ["use_localstorage_for_settings"],
                "enabled_features": ["study_templates"]
            });
        }
        
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initTradingView, 2000);
        });
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            setTimeout(initTradingView, 1000);
        });

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Å ML
        function updateAnalysis() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ - –∏–∑ TradingView API)
            const marketData = getRealImpulseData();

            // üîß –ë–ï–ó–û–ü–ê–°–ù–û–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
            const priceVelEl = document.getElementById('price-velocity');
            const ema20VelEl = document.getElementById('ema20-velocity');
            const ema20AngleEl = document.getElementById('ema20-angle');
            const priceDistEl = document.getElementById('price-distance');
            
            if (priceVelEl && marketData.priceVelocity !== undefined) priceVelEl.textContent = marketData.priceVelocity.toFixed(3);
            if (ema20VelEl && marketData.ema20Velocity !== undefined) ema20VelEl.textContent = marketData.ema20Velocity.toFixed(3);
            if (ema20AngleEl && marketData.ema20Angle !== undefined) ema20AngleEl.textContent = marketData.ema20Angle.toFixed(1) + '¬∞';
            if (priceDistEl && marketData.priceDistance !== undefined) priceDistEl.textContent = marketData.priceDistance.toFixed(1) + '%';
            
            // üìä –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–º–ø—É–ª—å—Å–µ
            if (marketData.impulseName) {
                const headerEl = document.querySelector('.dashboard h2');
                if (headerEl) {
                    headerEl.textContent = `üéØ ML –ê–ù–ê–õ–ò–ó –ú–ò–ù–ò–ú–£–ú–û–í - ${marketData.impulseName}`;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ—á–∫–µ
                let pointInfo = document.getElementById('point-info');
                if (!pointInfo) {
                    pointInfo = document.createElement('div');
                    pointInfo.id = 'point-info';
                    pointInfo.style.cssText = 'font-size: 14px; margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;';
                    const featuresGrid = document.querySelector('.features-grid');
                    if (featuresGrid && featuresGrid.parentNode) {
                        featuresGrid.parentNode.insertBefore(pointInfo, featuresGrid);
                    }
                }
                
                pointInfo.innerHTML = `
                    üìç <strong>${marketData.pointInfo}</strong> 
                    ${marketData.isMinimum ? '<span style="color: #FF6B6B;">üî¥ –ú–ò–ù–ò–ú–£–ú!</span>' : '<span style="color: #666;">‚ö´ –û–±—ã—á–Ω–∞—è —Ç–æ—á–∫–∞</span>'}
                `;
            }

            // ü§ñ ML –ü–†–ï–î–°–ö–ê–ó–ê–ù–ò–ï
            const features = [
                marketData.priceVelocity,
                marketData.ema20Velocity, 
                marketData.ema20Angle,
                marketData.priceDistance
            ];
            
            const mlResult = mlDetector.predict(features, marketData);
            const recommendation = mlResult.recommendation;
            
            console.log('ü§ñ ML –∞–Ω–∞–ª–∏–∑ —Å –£–î–ï–õ–¨–ù–´–ú–ò –í–ï–°–ê–ú–ò:', {
                phase: `${mlResult.phase.toUpperCase()} (${mlResult.month})`,
                features: features,
                marketType: mlResult.marketType,
                '‚öñÔ∏è –£–î–ï–õ–¨–ù–´–ï –í–ï–°–ê': {
                    '–°–∫–æ—Ä–æ—Å—Ç—å —Ü–µ–Ω—ã': (mlResult.activeWeights.priceVelocity * 100).toFixed(1) + '%',
                    '–°–∫–æ—Ä–æ—Å—Ç—å EMA20': (mlResult.activeWeights.ema20Velocity * 100).toFixed(1) + '%', 
                    '–£–≥–æ–ª EMA20': (mlResult.activeWeights.ema20Angle * 100).toFixed(1) + '%',
                    '–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ EMA20': (mlResult.activeWeights.priceDistance * 100).toFixed(1) + '%'
                },
                'üìä –†–ê–°–ß–ï–¢–´': {
                    weightedScore: mlResult.weightedScore?.toFixed(3),
                    synergy: mlResult.synergy?.toFixed(3),
                    confidence: (mlResult.confidence * 100).toFixed(1) + '%'
                },
                isMinimum: mlResult.isMinimum,
                action: recommendation.action,
                trainingStats: mlResult.trainingStats
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            const statusElement = document.getElementById('prediction-status');
            statusElement.textContent = recommendation.emoji + ' ' + recommendation.action;
            statusElement.className = `status ${recommendation.color}`;
            
            document.getElementById('prediction-confidence').textContent = 
                `–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(mlResult.confidence * 100).toFixed(1)}%`;
            
            // üìÖ –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ñ–∞–∑—ã
            updatePhaseIndicator(mlResult.phase, mlResult.month, mlResult.trainingStats);
            
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤
        if (mlResult.phase === 'training' || mlResult.confidence > 0.4) {
            addSignalToHistory(recommendation.emoji, recommendation.action, mlResult.confidence);
        }
        
        // üéØ BUY –ú–ê–†–ö–ï–†–´ - –°–ê–ú–ê–Ø –í–ê–ñ–ù–ê–Ø –õ–û–ì–ò–ö–ê!
        console.log(`üîç –ì–õ–ê–í–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê BUY: phase=${mlResult.phase}, confidence=${(mlResult.confidence * 100).toFixed(1)}%`);
        
        if (mlResult.phase === 'training') {
            // üéì –í –û–ë–£–ß–ï–ù–ò–ò - BUY –º–∞—Ä–∫–µ—Ä—ã —Ç–æ–ª—å–∫–æ –Ω–∞ –†–ï–ê–õ–¨–ù–´–• –ú–ò–ù–ò–ú–£–ú–ê–• –∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–±—É—á–µ–Ω–∏–µ –ù–ï –∑–∞–≤–µ—Ä—à–µ–Ω–æ!
            if (marketData.isMinimum && !marketData.learningComplete) {
                console.log(`üî¥ –ú–ò–ù–ò–ú–£–ú –ù–ê–ô–î–ï–ù! –°—Ç–∞–≤–∏–º BUY –º–∞—Ä–∫–µ—Ä: ${marketData.impulseName}, ${marketData.pointInfo}`);
                console.log(`üéØ –í–´–ó–´–í–ê–Æ addBuyMarkerToChart(${(mlResult.confidence * 100).toFixed(1)}%) –¥–ª—è –ú–ò–ù–ò–ú–£–ú–ê!`);
                addBuyMarkerToChart(mlResult.confidence);
            } else if (marketData.learningComplete) {
                console.log(`‚è∏Ô∏è –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –Ω–∞ –∏–º–ø—É–ª—å—Å–µ #${marketData.impulseNumber}. –û–∂–∏–¥–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è...`);
            } else {
                console.log(`‚ö´ –û–±—ã—á–Ω–∞—è —Ç–æ—á–∫–∞: ${marketData.impulseName}, ${marketData.pointInfo} - BUY –º–∞—Ä–∫–µ—Ä –ù–ï —Å—Ç–∞–≤–∏–º`);
            }
        } else if (mlResult.phase === 'backtesting' && mlResult.confidence > 0.6) {
            // üìä –í –ë–≠–ö–¢–ï–°–¢–ï - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (–ø—Ä–∏–º–µ–Ω—è–µ–º –∑–Ω–∞–Ω–∏—è!)
            console.log(`üéØ –ë–≠–ö–¢–ï–°–¢: –°—Ç–∞–≤–∏–º BUY –º–∞—Ä–∫–µ—Ä! –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(mlResult.confidence * 100).toFixed(1)}%`);
            addBuyMarkerToChart(mlResult.confidence);
        }
            
            // üìä –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏
            updateProfitabilityStats();
        }
        
        // üéØ –†–ï–ê–õ–¨–ù–´–ï –ò–ú–ü–£–õ–¨–°–´ - –î–∞–Ω–Ω—ã–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–≤–∏–∂–µ–Ω–∏–π –≤–Ω–∏–∑
        // üìâ –ò–ú–ü–£–õ–¨–°–´ –í–ù–ò–ó (–¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è LONG)
        const realImpulses = [
            // –ò–º–ø—É–ª—å—Å 1: BTC 15.01.2025 (—Å–∏–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ —Å –∫–æ—Ä—Ä–µ–∫—Ü–∏–µ–π)
            {
                name: "BTC 15.01.2025 - –ò–º–ø—É–ª—å—Å –≤–Ω–∏–∑ 8.5%",
                trajectory: [
                    {point: 1, priceVelocity: -0.003, ema20Velocity: -0.001, ema20Angle: -0.2, priceDistance: 1.2},
                    {point: 2, priceVelocity: -0.008, ema20Velocity: -0.003, ema20Angle: -0.8, priceDistance: 2.1},
                    {point: 3, priceVelocity: -0.015, ema20Velocity: -0.007, ema20Angle: -1.5, priceDistance: 4.3}, // –£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–∞–¥–µ–Ω–∏—è
                    {point: 4, priceVelocity: -0.025, ema20Velocity: -0.012, ema20Angle: -2.8, priceDistance: 7.8}, // –ü–∏–∫ –ø–∞–¥–µ–Ω–∏—è
                    {point: 5, priceVelocity: -0.031, ema20Velocity: -0.018, ema20Angle: -3.4, priceDistance: 12.5}, // –ú–ò–ù–ò–ú–£–ú!
                    {point: 6, priceVelocity: -0.018, ema20Velocity: -0.015, ema20Angle: -2.1, priceDistance: 9.2}, // –ö–æ—Ä—Ä–µ–∫—Ü–∏—è
                    {point: 7, priceVelocity: 0.005, ema20Velocity: -0.008, ema20Angle: -0.5, priceDistance: 5.1}, // –û—Ç—Å–∫–æ–∫
                    {point: 8, priceVelocity: 0.012, ema20Velocity: 0.002, ema20Angle: 0.3, priceDistance: 2.8}
                ],
                minimumPoint: 5
            },
            // –ò–º–ø—É–ª—å—Å 2: ETH 22.01.2025 
            {
                name: "ETH 22.01.2025 - –ò–º–ø—É–ª—å—Å –≤–Ω–∏–∑ 6.2%",
                trajectory: [
                    {point: 1, priceVelocity: -0.002, ema20Velocity: 0.001, ema20Angle: 0.1, priceDistance: 0.8},
                    {point: 2, priceVelocity: -0.006, ema20Velocity: -0.002, ema20Angle: -0.4, priceDistance: 1.5},
                    {point: 3, priceVelocity: -0.012, ema20Velocity: -0.005, ema20Angle: -1.2, priceDistance: 3.2},
                    {point: 4, priceVelocity: -0.019, ema20Velocity: -0.009, ema20Angle: -2.1, priceDistance: 5.8}, // –ú–ò–ù–ò–ú–£–ú!
                    {point: 5, priceVelocity: -0.008, ema20Velocity: -0.007, ema20Angle: -1.3, priceDistance: 4.1}, // –ö–æ—Ä—Ä–µ–∫—Ü–∏—è
                    {point: 6, priceVelocity: 0.003, ema20Velocity: -0.003, ema20Angle: -0.2, priceDistance: 2.3}
                ],
                minimumPoint: 4
            },
            // –ò–º–ø—É–ª—å—Å 3: SOL 28.01.2025
            {
                name: "SOL 28.01.2025 - –ò–º–ø—É–ª—å—Å –≤–Ω–∏–∑ 11.3%",
                trajectory: [
                    {point: 1, priceVelocity: -0.001, ema20Velocity: 0.002, ema20Angle: 0.3, priceDistance: 0.5},
                    {point: 2, priceVelocity: -0.007, ema20Velocity: -0.001, ema20Angle: -0.2, priceDistance: 1.8},
                    {point: 3, priceVelocity: -0.018, ema20Velocity: -0.006, ema20Angle: -1.1, priceDistance: 4.2},
                    {point: 4, priceVelocity: -0.033, ema20Velocity: -0.014, ema20Angle: -2.9, priceDistance: 8.7},
                    {point: 5, priceVelocity: -0.042, ema20Velocity: -0.021, ema20Angle: -4.1, priceDistance: 15.2}, // –ú–ò–ù–ò–ú–£–ú!
                    {point: 6, priceVelocity: -0.028, ema20Velocity: -0.018, ema20Angle: -2.8, priceDistance: 11.3},
                    {point: 7, priceVelocity: -0.012, ema20Velocity: -0.011, ema20Angle: -1.4, priceDistance: 7.8},
                    {point: 8, priceVelocity: 0.008, ema20Velocity: -0.005, ema20Angle: -0.3, priceDistance: 4.2}
                ],
                minimumPoint: 5
            },
            // –ò–º–ø—É–ª—å—Å 4: ADA 05.02.2025 (—Ä–∞–∑–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏)
            {
                name: "ADA 05.02.2025 - –ò–º–ø—É–ª—å—Å –≤–Ω–∏–∑ 7.8%",
                trajectory: [
                    {point: 1, priceVelocity: -0.004, ema20Velocity: -0.002, ema20Angle: -0.5, priceDistance: 1.1},
                    {point: 2, priceVelocity: -0.011, ema20Velocity: -0.005, ema20Angle: -1.2, priceDistance: 2.8},
                    {point: 3, priceVelocity: -0.021, ema20Velocity: -0.011, ema20Angle: -2.3, priceDistance: 5.9}, // –ú–ò–ù–ò–ú–£–ú!
                    {point: 4, priceVelocity: -0.014, ema20Velocity: -0.009, ema20Angle: -1.7, priceDistance: 4.2},
                    {point: 5, priceVelocity: 0.002, ema20Velocity: -0.004, ema20Angle: -0.4, priceDistance: 2.1}
                ],
                minimumPoint: 3
            },
            // –ò–º–ø—É–ª—å—Å 5: MATIC 12.02.2025 (–±—ã—Å—Ç—Ä—ã–π –º–∏–Ω–∏–º—É–º)
            {
                name: "MATIC 12.02.2025 - –ò–º–ø—É–ª—å—Å –≤–Ω–∏–∑ 5.2%",
                trajectory: [
                    {point: 1, priceVelocity: -0.009, ema20Velocity: -0.003, ema20Angle: -0.8, priceDistance: 1.9},
                    {point: 2, priceVelocity: -0.016, ema20Velocity: -0.008, ema20Angle: -1.8, priceDistance: 4.1}, // –ú–ò–ù–ò–ú–£–ú!
                    {point: 3, priceVelocity: -0.005, ema20Velocity: -0.006, ema20Angle: -0.9, priceDistance: 2.7},
                    {point: 4, priceVelocity: 0.007, ema20Velocity: -0.002, ema20Angle: -0.1, priceDistance: 1.3}
                ],
                minimumPoint: 2
            }
        ];

        // üìà –ö–û–†–†–ï–ö–¶–ò–ò –í–í–ï–†–• (–¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è LONG) - –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è!
        const correctionImpulses = [
            // –ö–æ—Ä—Ä–µ–∫—Ü–∏—è 1: BTC –ø–æ—Å–ª–µ –º–∏–Ω–∏–º—É–º–∞ 15.01.2025 (+4.2%)
            {
                name: "BTC 16.01.2025 - –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –≤–≤–µ—Ä—Ö +4.2%",
                trajectory: [
                    {point: 1, priceVelocity: +0.005, ema20Velocity: +0.002, ema20Angle: +0.3, priceDistance: -1.1}, // –ù–∞—á–∞–ª–æ —Ä–æ—Å—Ç–∞
                    {point: 2, priceVelocity: +0.012, ema20Velocity: +0.005, ema20Angle: +0.9, priceDistance: -2.3}, // –£—Å–∫–æ—Ä–µ–Ω–∏–µ
                    {point: 3, priceVelocity: +0.018, ema20Velocity: +0.008, ema20Angle: +1.6, priceDistance: -3.8}, // –ü–∏–∫ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
                    {point: 4, priceVelocity: +0.008, ema20Velocity: +0.003, ema20Angle: +0.4, priceDistance: -1.9}  // –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ
                ],
                minimumPoint: 3 // –ú–∞–∫—Å–∏–º—É–º –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ LONG
            },
            // –ö–æ—Ä—Ä–µ–∫—Ü–∏—è 2: ETH –ø–æ—Å–ª–µ –º–∏–Ω–∏–º—É–º–∞ 22.01.2025 (+3.1%)
            {
                name: "ETH 23.01.2025 - –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –≤–≤–µ—Ä—Ö +3.1%",
                trajectory: [
                    {point: 1, priceVelocity: +0.004, ema20Velocity: +0.001, ema20Angle: +0.2, priceDistance: -0.8},
                    {point: 2, priceVelocity: +0.009, ema20Velocity: +0.004, ema20Angle: +0.7, priceDistance: -1.7},
                    {point: 3, priceVelocity: +0.014, ema20Velocity: +0.007, ema20Angle: +1.3, priceDistance: -2.9}, // –ú–∞–∫—Å–∏–º—É–º
                    {point: 4, priceVelocity: +0.006, ema20Velocity: +0.002, ema20Angle: +0.3, priceDistance: -1.4}
                ],
                minimumPoint: 3
            },
            // –ö–æ—Ä—Ä–µ–∫—Ü–∏—è 3: SOL –ø–æ—Å–ª–µ –º–∏–Ω–∏–º—É–º–∞ 28.01.2025 (+5.7%)
            {
                name: "SOL 29.01.2025 - –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –≤–≤–µ—Ä—Ö +5.7%",
                trajectory: [
                    {point: 1, priceVelocity: +0.008, ema20Velocity: +0.003, ema20Angle: +0.4, priceDistance: -1.3},
                    {point: 2, priceVelocity: +0.016, ema20Velocity: +0.007, ema20Angle: +1.1, priceDistance: -2.8},
                    {point: 3, priceVelocity: +0.025, ema20Velocity: +0.012, ema20Angle: +2.1, priceDistance: -4.9}, // –ú–∞–∫—Å–∏–º—É–º
                    {point: 4, priceVelocity: +0.011, ema20Velocity: +0.005, ema20Angle: +0.6, priceDistance: -2.2}
                ],
                minimumPoint: 3
            },
            // –ö–æ—Ä—Ä–µ–∫—Ü–∏—è 4: ADA –ø–æ—Å–ª–µ –º–∏–Ω–∏–º—É–º–∞ 05.02.2025 (+2.8%)
            {
                name: "ADA 06.02.2025 - –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –≤–≤–µ—Ä—Ö +2.8%",
                trajectory: [
                    {point: 1, priceVelocity: +0.006, ema20Velocity: +0.002, ema20Angle: +0.3, priceDistance: -0.9},
                    {point: 2, priceVelocity: +0.013, ema20Velocity: +0.006, ema20Angle: +1.0, priceDistance: -2.1}, // –ú–∞–∫—Å–∏–º—É–º
                    {point: 3, priceVelocity: +0.007, ema20Velocity: +0.003, ema20Angle: +0.4, priceDistance: -1.3}
                ],
                minimumPoint: 2
            },
            // –ö–æ—Ä—Ä–µ–∫—Ü–∏—è 5: MATIC –ø–æ—Å–ª–µ –º–∏–Ω–∏–º—É–º–∞ 12.02.2025 (+1.9%)
            {
                name: "MATIC 13.02.2025 - –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –≤–≤–µ—Ä—Ö +1.9%",
                trajectory: [
                    {point: 1, priceVelocity: +0.005, ema20Velocity: +0.002, ema20Angle: +0.4, priceDistance: -1.1},
                    {point: 2, priceVelocity: +0.009, ema20Velocity: +0.004, ema20Angle: +0.8, priceDistance: -1.8}, // –ú–∞–∫—Å–∏–º—É–º
                    {point: 3, priceVelocity: +0.003, ema20Velocity: +0.001, ema20Angle: +0.2, priceDistance: -0.7}
                ],
                minimumPoint: 2
            }
        ];

        // üß™ –§–ï–í–†–ê–õ–¨–°–ö–ò–ï –î–ê–ù–ù–´–ï - –¥–ª—è —á–µ—Å—Ç–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ù–û–í–´–• –¥–∞–Ω–Ω—ã—Ö
        const februaryImpulses = [
            // –§–µ–≤—Ä–∞–ª—å 1: BNB 01.02.2025 (–Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)
            {
                name: "BNB 01.02.2025 - –§–µ–≤—Ä–∞–ª—å—Å–∫–∏–π –∏–º–ø—É–ª—å—Å 6.8%",
                trajectory: [
                    {point: 1, priceVelocity: -0.003, ema20Velocity: -0.001, ema20Angle: -0.3, priceDistance: 0.9},
                    {point: 2, priceVelocity: -0.009, ema20Velocity: -0.004, ema20Angle: -0.7, priceDistance: 2.2},
                    {point: 3, priceVelocity: -0.017, ema20Velocity: -0.008, ema20Angle: -1.6, priceDistance: 4.1},
                    {point: 4, priceVelocity: -0.025, ema20Velocity: -0.013, ema20Angle: -2.4, priceDistance: 6.8}, // –ú–ò–ù–ò–ú–£–ú
                    {point: 5, priceVelocity: -0.012, ema20Velocity: -0.009, ema20Angle: -1.1, priceDistance: 3.8},
                    {point: 6, priceVelocity: 0.004, ema20Velocity: -0.003, ema20Angle: -0.2, priceDistance: 1.9}
                ],
                minimumPoint: 4
            },
            
            // –§–µ–≤—Ä–∞–ª—å 2: XRP 05.02.2025
            {
                name: "XRP 05.02.2025 - –§–µ–≤—Ä–∞–ª—å—Å–∫–∏–π –∏–º–ø—É–ª—å—Å 9.2%",
                trajectory: [
                    {point: 1, priceVelocity: -0.006, ema20Velocity: -0.002, ema20Angle: -0.5, priceDistance: 1.3},
                    {point: 2, priceVelocity: -0.014, ema20Velocity: -0.006, ema20Angle: -1.1, priceDistance: 3.1},
                    {point: 3, priceVelocity: -0.028, ema20Velocity: -0.015, ema20Angle: -2.8, priceDistance: 7.2},
                    {point: 4, priceVelocity: -0.038, ema20Velocity: -0.021, ema20Angle: -3.9, priceDistance: 9.2}, // –ú–ò–ù–ò–ú–£–ú
                    {point: 5, priceVelocity: -0.019, ema20Velocity: -0.016, ema20Angle: -2.1, priceDistance: 6.1},
                    {point: 6, priceVelocity: -0.007, ema20Velocity: -0.008, ema20Angle: -0.8, priceDistance: 3.4},
                    {point: 7, priceVelocity: 0.008, ema20Velocity: -0.002, ema20Angle: 0.1, priceDistance: 1.8}
                ],
                minimumPoint: 4
            },
            
            // –§–µ–≤—Ä–∞–ª—å 3: LTC 10.02.2025
            {
                name: "LTC 10.02.2025 - –§–µ–≤—Ä–∞–ª—å—Å–∫–∏–π –∏–º–ø—É–ª—å—Å 4.5%",
                trajectory: [
                    {point: 1, priceVelocity: -0.008, ema20Velocity: -0.003, ema20Angle: -0.6, priceDistance: 1.6},
                    {point: 2, priceVelocity: -0.016, ema20Velocity: -0.007, ema20Angle: -1.4, priceDistance: 3.2},
                    {point: 3, priceVelocity: -0.021, ema20Velocity: -0.011, ema20Angle: -2.0, priceDistance: 4.5}, // –ú–ò–ù–ò–ú–£–ú
                    {point: 4, priceVelocity: -0.013, ema20Velocity: -0.008, ema20Angle: -1.2, priceDistance: 2.9},
                    {point: 5, priceVelocity: 0.001, ema20Velocity: -0.004, ema20Angle: -0.3, priceDistance: 1.5}
                ],
                minimumPoint: 3
            }
        ];

        // üß™ –¢–ï–°–¢–û–í–´–ï –ò–ú–ü–£–õ–¨–°–´ - –¥–ª—è —á–µ—Å—Ç–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ù–û–í–´–• –¥–∞–Ω–Ω—ã—Ö
        const testImpulses = [
            // –¢–µ—Å—Ç 1: AVAX 20.01.2025 (–ø–æ—Ö–æ–∂–∏–π –Ω–∞ BTC, –Ω–æ –¥—Ä—É–≥–∏–µ —Ü–∏—Ñ—Ä—ã)
            {
                name: "AVAX 20.01.2025 - –¢–µ—Å—Ç –∏–º–ø—É–ª—å—Å 9.1%",
                trajectory: [
                    {point: 1, priceVelocity: -0.005, ema20Velocity: -0.002, ema20Angle: -0.4, priceDistance: 1.4},
                    {point: 2, priceVelocity: -0.012, ema20Velocity: -0.005, ema20Angle: -1.1, priceDistance: 2.8},
                    {point: 3, priceVelocity: -0.022, ema20Velocity: -0.010, ema20Angle: -2.1, priceDistance: 5.5},
                    {point: 4, priceVelocity: -0.035, ema20Velocity: -0.017, ema20Angle: -3.2, priceDistance: 9.1}, // –ú–ò–ù–ò–ú–£–ú!
                    {point: 5, priceVelocity: -0.024, ema20Velocity: -0.014, ema20Angle: -2.4, priceDistance: 6.8},
                    {point: 6, priceVelocity: -0.008, ema20Velocity: -0.009, ema20Angle: -0.7, priceDistance: 3.2}
                ],
                minimumPoint: 4
            },
            // –¢–µ—Å—Ç 2: DOT 25.01.2025 (–ø–æ—Ö–æ–∂–∏–π –Ω–∞ ETH, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ)
            {
                name: "DOT 25.01.2025 - –¢–µ—Å—Ç –∏–º–ø—É–ª—å—Å 6.7%",
                trajectory: [
                    {point: 1, priceVelocity: -0.003, ema20Velocity: 0.001, ema20Angle: 0.2, priceDistance: 0.9},
                    {point: 2, priceVelocity: -0.009, ema20Velocity: -0.003, ema20Angle: -0.6, priceDistance: 2.1},
                    {point: 3, priceVelocity: -0.017, ema20Velocity: -0.008, ema20Angle: -1.8, priceDistance: 4.8}, // –ú–ò–ù–ò–ú–£–ú!
                    {point: 4, priceVelocity: -0.011, ema20Velocity: -0.006, ema20Angle: -1.2, priceDistance: 3.4},
                    {point: 5, priceVelocity: 0.001, ema20Velocity: -0.002, ema20Angle: -0.1, priceDistance: 1.8}
                ],
                minimumPoint: 3
            },
            // –¢–µ—Å—Ç 3: LINK 30.01.2025 (—Å–ª–æ–∂–Ω—ã–π —Å–ª—É—á–∞–π - —Ä–∞–Ω–Ω–∏–π –º–∏–Ω–∏–º—É–º)
            {
                name: "LINK 30.01.2025 - –¢–µ—Å—Ç –∏–º–ø—É–ª—å—Å 4.8%",
                trajectory: [
                    {point: 1, priceVelocity: -0.013, ema20Velocity: -0.004, ema20Angle: -1.0, priceDistance: 2.3},
                    {point: 2, priceVelocity: -0.019, ema20Velocity: -0.009, ema20Angle: -1.9, priceDistance: 4.8}, // –ú–ò–ù–ò–ú–£–ú!
                    {point: 3, priceVelocity: -0.007, ema20Velocity: -0.007, ema20Angle: -0.8, priceDistance: 3.1},
                    {point: 4, priceVelocity: 0.005, ema20Velocity: -0.003, ema20Angle: -0.2, priceDistance: 1.5}
                ],
                minimumPoint: 2
            }
        ];

        // üéØ –°–ò–°–¢–ï–ú–ê –û–ë–£–ß–ï–ù–ò–Ø –ü–û –û–î–ù–û–ú–£ –ò–ú–ü–£–õ–¨–°–£
        let currentImpulse = 0;
        let currentTrajectoryPoint = 0;
        let isLearningComplete = false; // –û–±—É—á–µ–Ω–∏–µ –Ω–∞ —Ç–µ–∫—É—â–µ–º –∏–º–ø—É–ª—å—Å–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ?
        let learnedPatterns = []; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –∏–º–ø—É–ª—å—Å–∞
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–µ–π —Ç–æ—á–∫–∏ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏
        function getRealImpulseData() {
            // –í—ã–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–∞–∑—ã
            let currentImpulses;
            if (mlDetector.currentPhase === 'training') {
                currentImpulses = realImpulses; // –Ø–Ω–≤–∞—Ä—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
            } else {
                currentImpulses = februaryImpulses; // –§–µ–≤—Ä–∞–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            }
            
            const impulse = currentImpulses[currentImpulse];
            if (!impulse) {
                // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å, –Ω–∞—á–∏–Ω–∞–µ–º —Å–Ω–∞—á–∞–ª–∞
                currentImpulse = 0;
                return getRealImpulseData();
            }
            
            const point = impulse.trajectory[currentTrajectoryPoint];
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–º–ø—É–ª—å—Å–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏
            if (currentTrajectoryPoint === 0) {
                if (mlDetector.currentPhase === 'training') {
                    console.log(`üéØ –ù–ê–ß–ò–ù–ê–ï–ú –û–ë–£–ß–ï–ù–ò–ï –ù–ê –ò–ú–ü–£–õ–¨–°–ï #${currentImpulse + 1}: ${impulse.name}`);
                    console.log(`üìç –ú–∏–Ω–∏–º—É–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Ç–æ—á–∫–µ ${impulse.minimumPoint} –∏–∑ ${impulse.trajectory.length}`);
                    isLearningComplete = false;
                } else {
                    console.log(`üß™ –ß–ï–°–¢–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï #${currentImpulse + 1}: ${impulse.name}`);
                    console.log(`üìä –û–∂–∏–¥–∞–µ–º—ã–π –º–∏–Ω–∏–º—É–º –Ω–∞ —Ç–æ—á–∫–µ ${impulse.minimumPoint} (–Ω–æ —Å–∏—Å—Ç–µ–º–∞ –µ–≥–æ –ù–ï –∑–Ω–∞–µ—Ç!)`);
                    console.log(`‚öñÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑—É—á–µ–Ω–Ω—ã–µ –≤–µ—Å–∞ –±–µ–∑ –¥–æ–æ–±—É—á–µ–Ω–∏—è`);
                }
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∞—è —Ç–æ—á–∫–∞ –º–∏–Ω–∏–º—É–º–æ–º
            const isMinimumPoint = (currentTrajectoryPoint === impulse.minimumPoint);
            
            // –í —Ñ–µ–≤—Ä–∞–ª—å—Å–∫–æ–π —Ñ–∞–∑–µ —Å–∏—Å—Ç–µ–º–∞ –ù–ï –¥–æ–ª–∂–Ω–∞ –∑–Ω–∞—Ç—å –≥–¥–µ –º–∏–Ω–∏–º—É–º—ã!
            let isMinimumForSystem;
            if (mlDetector.currentPhase === 'training') {
                isMinimumForSystem = isMinimumPoint; // –í –æ–±—É—á–µ–Ω–∏–∏ –∑–Ω–∞–µ–º –≥–¥–µ –º–∏–Ω–∏–º—É–º—ã
            } else {
                isMinimumForSystem = false; // –í —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ù–ï –∑–Ω–∞–µ–º!
            }
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ç–æ—á–∫–µ
            currentTrajectoryPoint++;
            
            // üî¥ –û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –û–ë–£–ß–ï–ù–ò–ï –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∏–Ω–∏–º—É–º–∞!
            if (isMinimumPoint && !isLearningComplete) {
                console.log(`üî¥ –ú–ò–ù–ò–ú–£–ú –î–û–°–¢–ò–ì–ù–£–¢! –û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –û–ë–£–ß–ï–ù–ò–ï –ù–ê –ò–ú–ü–£–õ–¨–°–ï #${currentImpulse + 1}`);
                console.log(`üìä –ó–ê–ö–û–ù–û–ú–ï–†–ù–û–°–¢–¨ #${currentImpulse + 1} –ò–ó–£–ß–ï–ù–ê!`);
                
                // üîß –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø –í–ï–°–û–í –ù–ê –ú–ò–ù–ò–ú–£–ú–ï!
                console.log(`üîß –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø –í–ï–°–û–í –ù–ê –ú–ò–ù–ò–ú–£–ú–ï...`);
                const minFeatures = impulse.trajectory[impulse.minimumPoint - 1]; // -1 —Ç.–∫. –º–∞—Å—Å–∏–≤ —Å 0
                mlDetector.adaptWeightsToMinimum([
                    minFeatures.priceVelocity,
                    minFeatures.ema20Velocity, 
                    minFeatures.ema20Angle,
                    minFeatures.priceDistance
                ]);
                console.log(`üéØ –í–ï–°–ê –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –ê–î–ê–ü–¢–ò–†–û–í–ê–ù–´:`, mlDetector.weights);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å —ç—Ç–æ–≥–æ –∏–º–ø—É–ª—å—Å–∞
                const currentWeights = {...mlDetector.weights};
                learnedPatterns.push({
                    impulseNumber: currentImpulse + 1,
                    impulseName: impulse.name,
                    weights: currentWeights,
                    patternsLearned: mlDetector.trainingStats.patternsLearned
                });
                
                isLearningComplete = true;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—É—á–µ–Ω–∏—è
                console.log(`üß† –£–î–ï–õ–¨–ù–´–ï –í–ï–°–ê –ò–ú–ü–£–õ–¨–°–ê #${currentImpulse + 1} (–ê–î–ê–ü–¢–ò–†–û–í–ê–ù–ù–´–ï):`, {
                    '–°–∫–æ—Ä–æ—Å—Ç—å —Ü–µ–Ω—ã': (currentWeights.priceVelocity * 100).toFixed(1) + '%',
                    '–°–∫–æ—Ä–æ—Å—Ç—å EMA20': (currentWeights.ema20Velocity * 100).toFixed(1) + '%',
                    '–£–≥–æ–ª EMA20': (currentWeights.ema20Angle * 100).toFixed(1) + '%',
                    '–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ': (currentWeights.priceDistance * 100).toFixed(1) + '%'
                });
                
                // üéØ –î–í–û–ô–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï: –ù–ê –û–ë–£–ß–ï–ù–ù–´–• –ò –ù–û–í–´–• –î–ê–ù–ù–´–•!
                console.log(`\nüß™ –¢–ï–°–¢–ò–†–£–ï–ú –ú–û–î–ï–õ–¨ –ù–ê –í–°–ï–• –¢–û–ß–ö–ê–• –ò–ú–ü–£–õ–¨–°–ê #${currentImpulse + 1}:`);
                console.log(`üìö 1. –¢–ï–°–¢ –ù–ê –û–ë–£–ß–ï–ù–ù–´–• –î–ê–ù–ù–´–• (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—É—á–µ–Ω–∏—è):`);
                testModelOnWholeImpulse(impulse, currentWeights, 'trained');
                
                // –ß–µ—Å—Ç–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                if (testImpulses[currentImpulse]) {
                    console.log(`\nüî• 2. –ß–ï–°–¢–ù–´–ô –¢–ï–°–¢ –ù–ê –ù–û–í–´–• –î–ê–ù–ù–´–• (–ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–æ–±—â–µ–Ω–∏—è):`);
                    testModelOnWholeImpulse(testImpulses[currentImpulse], currentWeights, 'test');
                }
                
                // –ñ–¥–µ–º 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–º–ø—É–ª—å—Å—É
                setTimeout(() => {
                    currentImpulse = (currentImpulse + 1) % realImpulses.length;
                    currentTrajectoryPoint = 0;
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º ML –º–æ–¥–µ–ª—å –¥–ª—è –Ω–æ–≤–æ–≥–æ –∏–º–ø—É–ª—å—Å–∞
                    mlDetector.trainingData = [...mlDetector.trainingData.slice(0, 12)]; // –û—Å—Ç–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ 12 –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
                    mlDetector.trainingStats.patternsLearned = 12;
                    mlDetector.trainingStats.buyMarkersPlaced = 0;
                    
                    console.log(`üîÑ –ü–ï–†–ï–•–û–î–ò–ú –ö –ò–ú–ü–£–õ–¨–°–£ #${currentImpulse + 1}. –ú–æ–¥–µ–ª—å –°–ë–†–û–®–ï–ù–ê.`);
                    
                    // –ï—Å–ª–∏ –∏–∑—É—á–∏–ª–∏ –≤—Å–µ –∏–º–ø—É–ª—å—Å—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
                    if (learnedPatterns.length >= realImpulses.length) {
                        showFinalComparison();
                    }
                }, 10000);
            }
            
            // –ï—Å–ª–∏ –æ–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –±–µ–∑ –æ–±—É—á–µ–Ω–∏—è
            if (isLearningComplete) {
                console.log(`‚è∏Ô∏è –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –û–∂–∏–¥–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∏–º–ø—É–ª—å—Å...`);
            } else {
                console.log(`üìä –ò–∑—É—á–∞–µ–º —Ç–æ—á–∫—É ${currentTrajectoryPoint}/${impulse.trajectory.length}: ${isMinimumPoint ? 'üî¥ –ú–ò–ù–ò–ú–£–ú!' : '‚ö´ –û–±—ã—á–Ω–∞—è —Ç–æ—á–∫–∞'}`);
            }
            
            return {
                ...point,
                isMinimum: isMinimumForSystem, // –í —Ñ–µ–≤—Ä–∞–ª–µ –≤—Å–µ–≥–¥–∞ false!
                realMinimum: isMinimumPoint, // –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                impulseName: impulse.name,
                pointInfo: `–¢–æ—á–∫–∞ ${currentTrajectoryPoint}/${impulse.trajectory.length}`,
                learningComplete: isLearningComplete,
                impulseNumber: currentImpulse + 1,
                phase: mlDetector.currentPhase
            };
        }
        
        // üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –Ω–∞ –≤—Å–µ—Ö —Ç–æ—á–∫–∞—Ö –∏–º–ø—É–ª—å—Å–∞
        function testModelOnWholeImpulse(impulse, learnedWeights, testType = 'trained') {
            const isHonestTest = testType === 'test';
            const testIcon = isHonestTest ? 'üî•' : 'üìö';
            const testName = isHonestTest ? '–ß–ï–°–¢–ù–´–ô –¢–ï–°–¢ (–Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)' : '–¢–ï–°–¢ –ù–ê –û–ë–£–ß–ï–ù–ù–´–• –î–ê–ù–ù–´–•';
            
            console.log(`${testIcon} ${testName}`);
            console.log(`üìã –ê–ù–ê–õ–ò–ó –í–°–ï–• –¢–û–ß–ï–ö –ò–ú–ü–£–õ–¨–°–ê: ${impulse.name}`);
            console.log(`üìç –†–µ–∞–ª—å–Ω—ã–π –º–∏–Ω–∏–º—É–º –Ω–∞ —Ç–æ—á–∫–µ: ${impulse.minimumPoint}`);
            
            let detectedMinimums = [];
            let missedMinimums = [];
            
            impulse.trajectory.forEach((point, index) => {
                const pointNumber = index + 1;
                const features = [point.priceVelocity, point.ema20Velocity, point.ema20Angle, point.priceDistance];
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—É—á–µ–Ω–Ω—ã–µ –≤–µ—Å–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
                const weightedScore = features.reduce((sum, feature, i) => {
                    const weights = [learnedWeights.priceVelocity, learnedWeights.ema20Velocity, 
                                   learnedWeights.ema20Angle, learnedWeights.priceDistance];
                    return sum + Math.abs(feature) * weights[i];
                }, 0);
                
                // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô —Ä–∞—Å—á–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ - –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
                const maxExpectedScore = 3.0; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–∂–∏–¥–∞–µ–º—ã–π –≤–∑–≤–µ—à–µ–Ω–Ω—ã–π —Å—á–µ—Ç –¥–ª—è —Å–∏–ª—å–Ω–æ–≥–æ –º–∏–Ω–∏–º—É–º–∞
                const baseConfidence = Math.min(1, weightedScore / maxExpectedScore);
                
                // üß† –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –º–∏–Ω–∏–º—É–º–æ–≤
                let confidence = baseConfidence;
                
                // –ë–æ–Ω—É—Å –∑–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (—Å–∏–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ)
                const allNegative = features[0] < 0 && features[1] < 0 && features[2] < 0;
                if (allNegative) confidence *= 1.5; // +50% –∑–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
                
                // –ë–æ–Ω—É—Å –∑–∞ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ = –º–∏–Ω–∏–º—É–º –±–ª–∏–∑–∫–æ)
                const isExtreme = Math.abs(features[0]) > 0.025 || Math.abs(features[2]) > 2.5;
                if (isExtreme) confidence *= 1.3; // +30% –∑–∞ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ—Å—Ç—å
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º
                confidence = Math.min(1, confidence);
                
                const shouldPlaceBuyMarker = confidence > 0.4; // üîß –ü–û–ù–ò–ñ–ï–ù –ü–û–†–û–ì —Å 60% –¥–æ 40%
                
                const isRealMinimum = (pointNumber === impulse.minimumPoint);
                
                if (isRealMinimum && shouldPlaceBuyMarker) {
                    // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û –ù–ê–ô–î–ï–ù –ú–ò–ù–ò–ú–£–ú
                    console.log(`‚úÖ –¢–æ—á–∫–∞ ${pointNumber}: –ú–ò–ù–ò–ú–£–ú –ù–ê–ô–î–ï–ù! –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(confidence * 100).toFixed(1)}%`);
                    detectedMinimums.push({point: pointNumber, confidence: confidence, correct: true});
                } else if (isRealMinimum && !shouldPlaceBuyMarker) {
                    // ‚ùå –ü–†–û–ü–£–©–ï–ù –ú–ò–ù–ò–ú–£–ú
                    console.log(`‚ùå –¢–æ—á–∫–∞ ${pointNumber}: –ú–ò–ù–ò–ú–£–ú –ü–†–û–ü–£–©–ï–ù! –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(confidence * 100).toFixed(1)}% (–Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞ 40%)`);
                    missedMinimums.push({point: pointNumber, confidence: confidence, reason: '–ù–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å'});
                } else if (!isRealMinimum && shouldPlaceBuyMarker) {
                    // ‚ö†Ô∏è –õ–û–ñ–ù–´–ô –°–ò–ì–ù–ê–õ
                    console.log(`‚ö†Ô∏è –¢–æ—á–∫–∞ ${pointNumber}: –õ–û–ñ–ù–´–ô BUY! –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(confidence * 100).toFixed(1)}% (–ù–ï –º–∏–Ω–∏–º—É–º)`);
                    detectedMinimums.push({point: pointNumber, confidence: confidence, correct: false});
                } else {
                    // ‚ö´ –û–ë–´–ß–ù–ê–Ø –¢–û–ß–ö–ê - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–ø—É—â–µ–Ω–∞
                    console.log(`‚ö´ –¢–æ—á–∫–∞ ${pointNumber}: –û–±—ã—á–Ω–∞—è —Ç–æ—á–∫–∞. –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(confidence * 100).toFixed(1)}% - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–ø—É—â–µ–Ω–∞`);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è
                console.log(`   üìä –ü—Ä–∏–∑–Ω–∞–∫–∏: PriceVel=${point.priceVelocity.toFixed(3)}, EMA20Vel=${point.ema20Velocity.toFixed(3)}, ` +
                          `Angle=${point.ema20Angle.toFixed(1)}¬∞, Distance=${point.priceDistance.toFixed(1)}%`);
                console.log(`   ‚öñÔ∏è –í–∑–≤–µ—à–µ–Ω–Ω—ã–π —Å—á–µ—Ç: ${weightedScore.toFixed(3)} ‚Üí –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(confidence * 100).toFixed(1)}%`);
            });
            
            // –°–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            console.log(`\nüìä –°–í–û–î–ö–ê –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ò–ú–ü–£–õ–¨–°–ê #${impulse.impulseNumber || currentImpulse + 1}:`);
            console.log(`‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –º–∏–Ω–∏–º—É–º–æ–≤: ${detectedMinimums.filter(d => d.correct).length}`);
            console.log(`‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –º–∏–Ω–∏–º—É–º–æ–≤: ${missedMinimums.length}`);
            console.log(`‚ö†Ô∏è –õ–æ–∂–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤: ${detectedMinimums.filter(d => !d.correct).length}`);
            
            const accuracy = ((detectedMinimums.filter(d => d.correct).length) / 1) * 100; // 1 = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –º–∏–Ω–∏–º—É–º–æ–≤
            console.log(`üéØ –¢–û–ß–ù–û–°–¢–¨: ${accuracy.toFixed(1)}%`);
            
            if (missedMinimums.length > 0) {
                console.log(`\nüîç –ê–ù–ê–õ–ò–ó –ü–†–û–ü–£–©–ï–ù–ù–´–• –ú–ò–ù–ò–ú–£–ú–û–í:`);
                missedMinimums.forEach(missed => {
                    console.log(`   ‚ùå –¢–æ—á–∫–∞ ${missed.point}: ${missed.reason} (${(missed.confidence * 100).toFixed(1)}%)`);
                });
            }
            
            // üéØ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
            showImpulseTestResults(impulse, detectedMinimums, missedMinimums, accuracy, testType);
        }
        
        // üìä –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        function showImpulseTestResults(impulse, detected, missed, accuracy, testType = 'trained') {
            const isHonestTest = testType === 'test';
            const testIcon = isHonestTest ? 'üî•' : 'üìö';
            const testBadge = isHonestTest ? '–ß–ï–°–¢–ù–´–ô –¢–ï–°–¢' : '–¢–ï–°–¢ –ù–ê –û–ë–£–ß–ï–ù–ù–´–•';
            // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            let resultsContainer = document.getElementById('impulse-test-results');
            if (!resultsContainer) {
                resultsContainer = document.createElement('div');
                resultsContainer.id = 'impulse-test-results';
                resultsContainer.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    width: 350px;
                    max-height: 500px;
                    overflow-y: auto;
                    background: linear-gradient(45deg, #1a1a2e, #16213e);
                    border: 2px solid #4ECDC4;
                    border-radius: 15px;
                    padding: 15px;
                    z-index: 1000;
                    font-family: monospace;
                    font-size: 12px;
                    color: white;
                    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                `;
                document.body.appendChild(resultsContainer);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–ø—É–ª—å—Å–∞
            const resultDiv = document.createElement('div');
            resultDiv.style.cssText = `
                margin-bottom: 15px;
                padding: 10px;
                background: rgba(255,255,255,0.1);
                border-radius: 8px;
                border-left: 4px solid ${accuracy >= 100 ? '#4CAF50' : accuracy >= 50 ? '#FF9800' : '#f44336'};
            `;
            
            const correctMinimums = detected.filter(d => d.correct).length;
            const falseSignals = detected.filter(d => !d.correct).length;
            
            resultDiv.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 8px; color: #4ECDC4;">
                    ${testIcon} ${impulse.name}
                </div>
                <div style="font-size: 10px; margin-bottom: 6px; color: ${isHonestTest ? '#FF6B6B' : '#4CAF50'}; font-weight: bold;">
                    ${testBadge}
                </div>
                <div style="margin: 4px 0;">
                    üìç –†–µ–∞–ª—å–Ω—ã–π –º–∏–Ω–∏–º—É–º: —Ç–æ—á–∫–∞ ${impulse.minimumPoint}
                </div>
                <div style="margin: 4px 0; color: #4CAF50;">
                    ‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: ${correctMinimums}
                </div>
                <div style="margin: 4px 0; color: #f44336;">
                    ‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${missed.length}
                </div>
                <div style="margin: 4px 0; color: #FF9800;">
                    ‚ö†Ô∏è –õ–æ–∂–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤: ${falseSignals}
                </div>
                <div style="margin: 8px 0; font-weight: bold; color: ${accuracy >= 100 ? '#4CAF50' : accuracy >= 50 ? '#FF9800' : '#f44336'};">
                    üéØ –¢–û–ß–ù–û–°–¢–¨: ${accuracy.toFixed(1)}%
                </div>
                ${missed.length > 0 ? `
                    <div style="margin-top: 8px; font-size: 11px; color: #ffcdd2;">
                        üí° –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ: ${missed.map(m => `—Ç–æ—á–∫–∞ ${m.point} (${(m.confidence * 100).toFixed(1)}%)`).join(', ')}
                    </div>
                ` : ''}
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            resultsContainer.insertBefore(resultDiv, resultsContainer.firstChild);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–∫–∂–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            showTestCompletionNotification(impulse.name, accuracy, testType);
        }
        
        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function showTestCompletionNotification(impulseName, accuracy, testType = 'trained') {
            const isHonestTest = testType === 'test';
            const testIcon = isHonestTest ? 'üî•' : 'üìö';
            const testName = isHonestTest ? '–ß–ï–°–¢–ù–´–ô –¢–ï–°–¢' : '–¢–ï–°–¢ –û–ë–£–ß–ï–ù–ù–´–•';
            const bgGradient = isHonestTest ? 
                'linear-gradient(45deg, #FF6B6B, #FF9800)' : 
                'linear-gradient(45deg, #673AB7, #9C27B0)';
            
            const notification = document.createElement('div');
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${bgGradient};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.4);
                z-index: 1001;
                font-weight: bold;
                animation: slideDown 0.5s ease-out;
            `;
            
            notification.innerHTML = `
                ${testIcon} <strong>${testName} –ó–ê–í–ï–†–®–ï–ù!</strong><br>
                ${impulseName}<br>
                <span style="color: ${accuracy >= 100 ? '#4CAF50' : accuracy >= 50 ? '#FFEB3B' : '#f44336'};">
                    –¢–æ—á–Ω–æ—Å—Ç—å: ${accuracy.toFixed(1)}%
                </span>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // –£–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.5s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 500);
            }, 4000);
        }
        
        // üìä –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–µ–π
        function showFinalComparison() {
            console.log(`üéâ –í–°–ï ${learnedPatterns.length} –ò–ú–ü–£–õ–¨–°–û–í –ò–ó–£–ß–ï–ù–´! –°–†–ê–í–ù–ò–í–ê–ï–ú –ó–ê–ö–û–ù–û–ú–ï–†–ù–û–°–¢–ò:`);
            
            learnedPatterns.forEach((pattern, index) => {
                console.log(`\nüìä –ò–ú–ü–£–õ–¨–° #${pattern.impulseNumber} (${pattern.impulseName}):`);
                console.log(`   –°–∫–æ—Ä–æ—Å—Ç—å —Ü–µ–Ω—ã: ${(pattern.weights.priceVelocity * 100).toFixed(1)}%`);
                console.log(`   –°–∫–æ—Ä–æ—Å—Ç—å EMA20: ${(pattern.weights.ema20Velocity * 100).toFixed(1)}%`);
                console.log(`   –£–≥–æ–ª EMA20: ${(pattern.weights.ema20Angle * 100).toFixed(1)}%`);
                console.log(`   –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${(pattern.weights.priceDistance * 100).toFixed(1)}%`);
            });
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–µ –≤–µ—Å–∞
            const avgWeights = {
                priceVelocity: learnedPatterns.reduce((sum, p) => sum + p.weights.priceVelocity, 0) / learnedPatterns.length,
                ema20Velocity: learnedPatterns.reduce((sum, p) => sum + p.weights.ema20Velocity, 0) / learnedPatterns.length,
                ema20Angle: learnedPatterns.reduce((sum, p) => sum + p.weights.ema20Angle, 0) / learnedPatterns.length,
                priceDistance: learnedPatterns.reduce((sum, p) => sum + p.weights.priceDistance, 0) / learnedPatterns.length
            };
            
            console.log(`\nüß† –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –§–û–†–ú–£–õ–ê –ú–ò–ù–ò–ú–£–ú–û–í (—Å—Ä–µ–¥–Ω–∏–µ –≤–µ—Å–∞):`);
            console.log(`   –°–∫–æ—Ä–æ—Å—Ç—å —Ü–µ–Ω—ã: ${(avgWeights.priceVelocity * 100).toFixed(1)}%`);
            console.log(`   –°–∫–æ—Ä–æ—Å—Ç—å EMA20: ${(avgWeights.ema20Velocity * 100).toFixed(1)}%`);
            console.log(`   –£–≥–æ–ª EMA20: ${(avgWeights.ema20Angle * 100).toFixed(1)}%`);
            console.log(`   –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${(avgWeights.priceDistance * 100).toFixed(1)}%`);
        }
        
        // üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏
        let tradingStats = {
            totalTrades: 0,
            successfulTrades: 0,
            totalProfit: 0,
            avgProfit: 0,
            maxProfit: 0,
            activeTrades: new Map() // –•—Ä–∞–Ω–∏–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–¥–µ–ª–∫–∏
        };

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é —Å –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å—é
        function addSignalToHistory(emoji, action, confidence) {
            const historyContainer = document.getElementById('signals-history');
            const time = new Date().toLocaleTimeString('ru', {hour: '2-digit', minute: '2-digit'});
            const confidencePercent = (confidence * 100).toFixed(0);
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ - –∏–∑ TradingView)
            const entryPrice = 113000 + (Math.random() - 0.5) * 2000;
            const tradeId = Date.now();
            
            // –¢–æ—Ä–≥–æ–≤—ã–µ —Å–¥–µ–ª–∫–∏ –¢–û–õ–¨–ö–û –≤ —Ñ–µ–≤—Ä–∞–ª–µ (–±—ç–∫—Ç–µ—Å—Ç)!
            if (confidence > 0.6 && action.includes('–ú–ò–ù–ò–ú–£–ú') && 
                (mlDetector.currentPhase === 'backtesting')) {
                tradingStats.activeTrades.set(tradeId, {
                    entryPrice: entryPrice,
                    entryTime: time,
                    confidence: confidence
                });
                
                // –ß–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è —Å–∏–º—É–ª–∏—Ä—É–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ
                setTimeout(() => closeTradeSimulation(tradeId), 30000 + Math.random() * 60000);
            }
            
            const signalDiv = document.createElement('div');
            const bgColor = confidence > 0.8 ? 'rgba(76, 175, 80, 0.3)' : 
                           confidence > 0.6 ? 'rgba(255, 152, 0, 0.3)' : 'rgba(158, 158, 158, 0.3)';
            
            signalDiv.style.cssText = `
                padding: 10px; 
                margin: 5px 0; 
                background: ${bgColor}; 
                border-radius: 5px;
                font-size: 0.9em;
                border-left: 4px solid ${confidence > 0.8 ? '#4CAF50' : '#FF9800'};
            `;
            
            const profitInfo = confidence > 0.8 ? ` üí∞$${entryPrice.toFixed(0)}` : '';
            signalDiv.textContent = `${emoji} ${time} - ${action} (${confidencePercent}%)${profitInfo}`;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
            historyContainer.insertBefore(signalDiv, historyContainer.firstChild);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
            while (historyContainer.children.length > 5) {
                historyContainer.removeChild(historyContainer.lastChild);
            }
        }
        
        // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–¥–µ–ª–∫–∏
        function closeTradeSimulation(tradeId) {
            const trade = tradingStats.activeTrades.get(tradeId);
            if (!trade) return;
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ ML
            const profitChance = trade.confidence; // –ß–µ–º –≤—ã—à–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Ç–µ–º –±–æ–ª—å—à–µ —à–∞–Ω—Å –Ω–∞ –ø—Ä–∏–±—ã–ª—å
            const isProfit = Math.random() < profitChance;
            
            let profitPercent;
            if (isProfit) {
                // –ü—Ä–∏–±—ã–ª—å–Ω–∞—è —Å–¥–µ–ª–∫–∞: 1-8%
                profitPercent = 1 + Math.random() * 7;
            } else {
                // –£–±—ã—Ç–æ—á–Ω–∞—è —Å–¥–µ–ª–∫–∞: -1% –¥–æ -3%
                profitPercent = -(0.5 + Math.random() * 2.5);
            }
            
            const profitUSD = trade.entryPrice * (profitPercent / 100);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            tradingStats.totalTrades++;
            if (isProfit) tradingStats.successfulTrades++;
            tradingStats.totalProfit += profitUSD;
            tradingStats.avgProfit = tradingStats.totalProfit / tradingStats.totalTrades;
            if (profitPercent > tradingStats.maxProfit) tradingStats.maxProfit = profitPercent;
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö
            tradingStats.activeTrades.delete(tradeId);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const time = new Date().toLocaleTimeString('ru', {hour: '2-digit', minute: '2-digit'});
            const historyContainer = document.getElementById('signals-history');
            const resultDiv = document.createElement('div');
            
            resultDiv.style.cssText = `
                padding: 8px; 
                margin: 3px 0; 
                background: ${isProfit ? 'rgba(76, 175, 80, 0.4)' : 'rgba(244, 67, 54, 0.4)'}; 
                border-radius: 5px;
                font-size: 0.85em;
                border-left: 4px solid ${isProfit ? '#4CAF50' : '#f44336'};
            `;
            
            const emoji = isProfit ? '‚úÖ' : '‚ùå';
            const sign = profitPercent > 0 ? '+' : '';
            resultDiv.textContent = `${emoji} ${time} - –ó–∞–∫—Ä—ã—Ç–æ: ${sign}${profitPercent.toFixed(1)}% (${sign}$${profitUSD.toFixed(0)})`;
            
            historyContainer.insertBefore(resultDiv, historyContainer.firstChild);
        }
        
        // üéØ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ BUY –º–∞—Ä–∫–µ—Ä–∞ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫  
        function addBuyMarkerToChart(confidence) {
            const phase = mlDetector.currentPhase;
            const phaseText = phase === 'training' ? '–û–ë–£–ß–ï–ù–ò–ï' : '–ë–≠–ö–¢–ï–°–¢';
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç API TradingView –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤
            console.log(`üö®üéØ *** BUY –ú–ê–†–ö–ï–† –î–û–ë–ê–í–õ–ï–ù *** (${phaseText})! –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(confidence * 100).toFixed(1)}%`);
            console.log(`‚úÖ –í—Ä–µ–º—è: ${new Date().toLocaleTimeString()}, –§–∞–∑–∞: ${phase.toUpperCase()}`);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ñ–∞–∑—ã
            showBuyNotification(confidence, phase);
        }
        
        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ BUY —Å–∏–≥–Ω–∞–ª–µ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ñ–∞–∑—ã
        function showBuyNotification(confidence, phase = 'training') {
            const isTraining = phase === 'training';
            const notification = document.createElement('div');
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${isTraining ? 
                    'linear-gradient(45deg, #FF9800, #FFC107)' : 
                    'linear-gradient(45deg, #4CAF50, #8BC34A)'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 20px ${isTraining ? 
                    'rgba(255, 152, 0, 0.4)' : 
                    'rgba(76, 175, 80, 0.4)'};
                z-index: 1000;
                font-weight: bold;
                animation: slideIn 0.5s ease-out;
            `;
            
            notification.innerHTML = `
                ${isTraining ? 'üéì' : 'üéØ'} <strong>${isTraining ? '–û–ë–£–ß–ï–ù–ò–ï' : 'BUY –°–ò–ì–ù–ê–õ'}!</strong><br>
                –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(confidence * 100).toFixed(1)}%<br>
                <small>${isTraining ? 
                    '–ú–∏–Ω–∏–º—É–º –Ω–∞–π–¥–µ–Ω - –ø–∞—Ç—Ç–µ—Ä–Ω –∏–∑—É—á–µ–Ω' : 
                    '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—å –õ–û–ù–ì'}</small>
            `;
            
            document.body.appendChild(notification);
            
            // –£–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.5s ease-in';
                setTimeout(() => document.body.removeChild(notification), 500);
            }, 5000);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏
        function updateProfitabilityStats() {
            const winRate = tradingStats.totalTrades > 0 ? 
                (tradingStats.successfulTrades / tradingStats.totalTrades * 100).toFixed(1) : '0.0';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –µ—Å—Ç—å
            const elements = {
                'win-rate': winRate + '%',
                'total-profit': '$' + tradingStats.totalProfit.toFixed(0), 
                'avg-profit': tradingStats.avgProfit.toFixed(0) + '$',
                'active-trades': tradingStats.activeTrades.size
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
        }
        
        // üìÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Ñ–∞–∑—ã
        function updatePhaseIndicator(phase, month, trainingStats) {
            const indicator = document.getElementById('phase-indicator');
            if (!indicator) return;
            
            if (phase === 'training') {
                indicator.style.background = 'linear-gradient(45deg, #FF9800, #FFC107)';
                indicator.innerHTML = `üéì –§–ê–ó–ê –û–ë–£–ß–ï–ù–ò–Ø: –Ø–Ω–≤–∞—Ä—å 2025 
                    <br><small>–ü–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏–∑—É—á–µ–Ω–æ: ${trainingStats?.patternsLearned || 0} | BUY –º–∞—Ä–∫–µ—Ä–æ–≤: ${trainingStats?.buyMarkersPlaced || 0}</small>`;
            } else if (phase === 'production') {
                indicator.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
                indicator.innerHTML = `üöÄ –ü–†–û–î–ê–ö–®–ù: –ü—Ä–∏–º–µ–Ω—è–µ–º –º–æ–¥–µ–ª—å 
                    <br><small>–ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—É—á–µ–Ω–Ω—ã–µ –≤–µ—Å–∞ (${trainingStats?.patternsLearned || 0} –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏–∑—É—á–µ–Ω–æ)</small>`;
            } else {
                indicator.style.background = 'linear-gradient(45deg, #2196F3, #21CBF3)';
                indicator.innerHTML = `üß™ –ß–ï–°–¢–ù–´–ô –ë–≠–ö–¢–ï–°–¢: –§–µ–≤—Ä–∞–ª—å 2025 
                    <br><small>–¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∏–∑—É—á–µ–Ω–æ: ${trainingStats?.patternsLearned || 0} –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤)</small>`;
            }
        }

        // üöÄ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´
        window.mlDetector = new MinimumDetectorML();
        
        // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        const modelLoaded = window.mlDetector.loadTrainedModel();
        if (modelLoaded) {
            console.log('üöÄ –ó–ê–ü–£–°–ö –í –ü–†–û–î–ê–ö–®–ù –†–ï–ñ–ò–ú–ï: –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å!');
            updatePhaseIndicator('production', 'continuous', window.mlDetector.trainingStats);
        } else {
            console.log('üéì –ó–ê–ü–£–°–ö –í –û–ë–£–ß–ê–Æ–©–ï–ú –†–ï–ñ–ò–ú–ï: –ù–∞—á–∏–Ω–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ —Å –Ω—É–ª—è');
            updatePhaseIndicator('training', 'january', window.mlDetector.trainingStats);
        }

        // –¢–£–†–ë–û-–û–ë–£–ß–ï–ù–ò–ï: –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥!
        setInterval(updateAnalysis, 5000); // 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∫–∞–∂–¥—É—é —Ç–æ—á–∫—É –∏–º–ø—É–ª—å—Å–∞ –¥–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
        
        // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        updateAnalysis();
        
        // üéì –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –æ–±—É—á–µ–Ω–∏—è
        const restartBtn = document.createElement('button');
        restartBtn.innerHTML = 'üéì –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ';
        restartBtn.style.cssText = `
            position: fixed;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #FF9800, #FFC107);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        `;
        restartBtn.onclick = () => mlDetector.restartTraining();
        document.body.appendChild(restartBtn);
        
        // üíæ –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
        const loadModelBtn = document.createElement('button');
        loadModelBtn.innerHTML = 'üíæ –ó–ê–ì–†–£–ó–ò–¢–¨ –ú–û–î–ï–õ–¨';
        loadModelBtn.style.cssText = `
            position: fixed;
            top: 60px;
            left: 10px;
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        `;
        loadModelBtn.onclick = () => {
            const loaded = mlDetector.loadTrainedModel();
            if (loaded) {
                loadModelBtn.innerHTML = '‚úÖ –ú–û–î–ï–õ–¨ –ó–ê–ì–†–£–ñ–ï–ù–ê';
                loadModelBtn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
                console.log('üöÄ –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º!');
            } else {
                alert('‚ùå –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –°–Ω–∞—á–∞–ª–∞ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ.');
            }
        };
        document.body.appendChild(loadModelBtn);
        
        // üîÑ –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
        const switchBtn = document.createElement('button');
        switchBtn.innerHTML = 'üîÑ –ö–û–†–†–ï–ö–¶–ò–Ø (EXIT LONG)';
        switchBtn.style.cssText = `
            position: fixed;
            top: 120px;
            right: 20px;
            padding: 15px 25px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        `;
        switchBtn.onclick = () => {
            if (mlDetector.detectionMode === 'minimums') {
                mlDetector.switchDetectionMode('maximums');
                switchBtn.innerHTML = 'üìâ –ò–ú–ü–£–õ–¨–° (OPEN LONG)';
                switchBtn.style.background = 'linear-gradient(45deg, #f44336, #d32f2f)';
            } else {
                mlDetector.switchDetectionMode('minimums');
                switchBtn.innerHTML = 'üìà –ö–û–†–†–ï–ö–¶–ò–Ø (EXIT LONG)';
                switchBtn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
            }
        };

        // üîÑ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–æ–≤–æ–π –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
        const modeSwitchBtn = document.getElementById('mode-switch-btn');
        if (modeSwitchBtn) {
            modeSwitchBtn.onclick = () => {
                if (mlDetector.detectionMode === 'minimums') {
                    mlDetector.switchDetectionMode('maximums');
                    modeSwitchBtn.innerHTML = 'üìâ –ò–ú–ü–£–õ–¨–° (OPEN LONG)';
                    modeSwitchBtn.style.background = 'linear-gradient(45deg, #f44336, #d32f2f)';
                } else {
                    mlDetector.switchDetectionMode('minimums');
                    modeSwitchBtn.innerHTML = 'üîÑ –ö–û–†–†–ï–ö–¶–ò–Ø (EXIT LONG)';
                    modeSwitchBtn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
                }
            };
        }
        document.body.appendChild(switchBtn);
        
        // üìä –ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –î–û –ø–∏–≤–æ—Ç–∞  
        function analyzeDynamicsBeforePivot() {
            if (featuresHistory.length < 3) return;
            
            const last3 = featuresHistory.slice(-3);
            
            console.log('üìà –ê–ù–ê–õ–ò–ó –î–ò–ù–ê–ú–ò–ö–ò –î–û –ü–ò–í–û–¢–ê:');
            console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
            
            // –î–∏–Ω–∞–º–∏–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ü–µ–Ω—ã
            const priceVelTrend = [
                last3[0].priceVelocity,
                last3[1].priceVelocity, 
                last3[2].priceVelocity
            ];
            console.log('üìâ –°–∫–æ—Ä–æ—Å—Ç—å —Ü–µ–Ω—ã:', priceVelTrend.map(v => v.toFixed(3)).join(' ‚Üí '));
            
            // –î–∏–Ω–∞–º–∏–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ EMA20
            const ema20VelTrend = [
                last3[0].ema20Velocity,
                last3[1].ema20Velocity,
                last3[2].ema20Velocity
            ];
            console.log('üìä –°–∫–æ—Ä–æ—Å—Ç—å EMA20:', ema20VelTrend.map(v => v.toFixed(3)).join(' ‚Üí '));
            
            // –î–∏–Ω–∞–º–∏–∫–∞ —É–≥–ª–∞ EMA20
            const angleTrend = [
                last3[0].ema20Angle,
                last3[1].ema20Angle,
                last3[2].ema20Angle
            ];
            console.log('üìê –£–≥–æ–ª EMA20:', angleTrend.map(v => v.toFixed(1) + '¬∞').join(' ‚Üí '));
            
            // –î–∏–Ω–∞–º–∏–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
            const distanceTrend = [
                last3[0].priceDistance,
                last3[1].priceDistance,
                last3[2].priceDistance
            ];
            console.log('üìè –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ:', distanceTrend.map(v => v.toFixed(1) + '%').join(' ‚Üí '));
            
            // –í—ã–≤–æ–¥—ã –æ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—è—Ö
            const priceAcceleration = priceVelTrend[2] - priceVelTrend[0];
            const ema20Acceleration = ema20VelTrend[2] - ema20VelTrend[0];
            
            console.log('üîç –ó–ê–ö–û–ù–û–ú–ï–†–ù–û–°–¢–ò:');
            if (priceAcceleration < -0.005) {
                console.log('  ‚úÖ –ü–∞–¥–µ–Ω–∏–µ —Ü–µ–Ω—ã —É—Å–∫–æ—Ä—è–µ—Ç—Å—è!');
            }
            if (ema20Acceleration < -0.003) {
                console.log('  ‚úÖ EMA20 —Ç–æ–∂–µ –ø–∞–¥–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ!');
            }
            if (distanceTrend[2] < distanceTrend[0]) {
                console.log('  ‚úÖ –¶–µ–Ω–∞ —É—Ö–æ–¥–∏—Ç –æ—Ç EMA20!');
            }
            
            console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
        }

        // –§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–∞
        function resizeChart() {
            if (tvWidget) {
                setTimeout(() => {
                    initTradingView();
                }, 100);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', resizeChart);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        document.getElementById('symbol-select').addEventListener('change', function(e) {
            console.log('–°–∏–º–≤–æ–ª –∏–∑–º–µ–Ω–µ–Ω –Ω–∞:', e.target.value);
            updateAnalysis();
            resizeChart();
        });

        document.getElementById('timeframe-select').addEventListener('change', function(e) {
            console.log('–¢–∞–π–º—Ñ—Ä–µ–π–º –∏–∑–º–µ–Ω–µ–Ω –Ω–∞:', e.target.value);
            updateAnalysis();
            resizeChart();
        });
    </script>
</body>
</html>
